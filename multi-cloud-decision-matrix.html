<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Multi-Cloud Decision & Onboarding Wizard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      --bg: #050816;
      --bg-card: #0b1020;
      --accent: #6366f1;
      --accent-soft: rgba(99, 102, 241, 0.15);
      --text: #e5e7eb;
      --muted: #9ca3af;
      --danger: #f97373;
      --border: #1f2933;
      --radius: 14px;
      --shadow: 0 18px 45px rgba(0,0,0,0.65);
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      min-height: 100vh;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: radial-gradient(circle at top, #111827 0, #020617 55%);
      color: var(--text);
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 24px;
    }

    .app-shell {
      width: 100%;
      max-width: 1200px;
      background: linear-gradient(145deg, #020617 0, #020617 60%, #111827 100%);
      border-radius: 24px;
      padding: 24px 24px 18px;
      box-shadow: var(--shadow);
      border: 1px solid rgba(148, 163, 184, 0.1);
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 16px;
      padding-bottom: 10px;
      border-bottom: 1px solid rgba(55, 65, 81, 0.7);
    }

    header h1 {
      font-size: 1.4rem;
      margin: 0;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    header h1 span.logo-dot {
      width: 26px;
      height: 26px;
      border-radius: 999px;
      background: radial-gradient(circle at 30% 20%, #e0e7ff 0, var(--accent) 35%, #312e81 100%);
      box-shadow: 0 0 18px var(--accent);
    }

    header p {
      margin: 0;
      font-size: 0.85rem;
      color: var(--muted);
    }

    .cloud-picker {
      display: flex;
      flex-direction: column;
      align-items: flex-end;
      gap: 6px;
      font-size: 0.8rem;
    }

    .cloud-picker label {
      color: var(--muted);
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .cloud-picker select {
      border-radius: 999px;
      padding: 5px 10px;
      border: 1px solid rgba(148, 163, 184, 0.5);
      background: rgba(15, 23, 42, 0.9);
      color: var(--text);
      font-size: 0.82rem;
      outline: none;
    }

    .badge {
      padding: 4px 10px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.4);
      font-size: 0.75rem;
      color: var(--muted);
      background: rgba(15, 23, 42, 0.6);
      white-space: nowrap;
    }

    .content {
      display: grid;
      grid-template-columns: minmax(0, 2.2fr) minmax(0, 1.6fr);
      gap: 16px;
    }

    @media (max-width: 960px) {
      .content {
        grid-template-columns: minmax(0, 1fr);
      }
    }

    .card {
      background:
        radial-gradient(circle at top left, var(--accent-soft), transparent 52%),
        radial-gradient(circle at bottom right, rgba(16,185,129,0.08), transparent 60%),
        var(--bg-card);
      border-radius: var(--radius);
      border: 1px solid rgba(55, 65, 81, 0.7);
      padding: 18px 18px 16px;
      display: flex;
      flex-direction: column;
      gap: 12px;
      position: relative;
      overflow: hidden;
    }

    .card::before {
      content: "";
      position: absolute;
      inset: 0;
      background: linear-gradient(
        to bottom right,
        rgba(148, 163, 184, 0.08),
        transparent 40%
      );
      mix-blend-mode: soft-light;
      pointer-events: none;
    }

    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 10px;
      position: relative;
      z-index: 1;
    }

    .card-header h2 {
      margin: 0;
      font-size: 1.05rem;
      letter-spacing: 0.02em;
    }

    .step-indicator {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      font-size: 0.75rem;
      color: var(--muted);
    }

    .step-indicator span.step-dot {
      width: 8px;
      height: 8px;
      border-radius: 999px;
      background: var(--accent);
      box-shadow: 0 0 8px var(--accent);
    }

    .pill {
      font-size: 0.75rem;
      color: var(--muted);
      padding: 3px 9px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.85);
      border: 1px solid rgba(148, 163, 184, 0.25);
    }

    .badge-cloud {
      border-radius: 999px;
      padding: 3px 9px;
      font-size: 0.7rem;
      background: var(--accent-soft);
      border: 1px solid var(--accent);
      color: #e5e7eb;
    }

    .form-grid {
      display: grid;
      grid-template-columns: minmax(0, 1fr) minmax(0, 1fr);
      gap: 12px 16px;
      position: relative;
      z-index: 1;
    }

    @media (max-width: 640px) {
      .form-grid {
        grid-template-columns: minmax(0, 1fr);
      }
    }

    .path-grid {
      display: grid;
      grid-template-columns: minmax(0, 1fr) minmax(0, 1fr);
      gap: 12px 16px;
    }

    @media (max-width: 640px) {
      .path-grid {
        grid-template-columns: minmax(0, 1fr);
      }
    }

    .path-group {
      display: none;
    }

    .path-group.active {
      display: grid;
    }

    .field {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    label {
      font-size: 0.78rem;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: var(--muted);
    }

    label span.req {
      color: var(--danger);
      margin-left: 2px;
    }

    select,
    input[type="text"],
    textarea {
      border-radius: 10px;
      border: 1px solid var(--border);
      padding: 7px 9px;
      font-size: 0.87rem;
      background: rgba(15, 23, 42, 0.9);
      color: var(--text);
      outline: none;
      transition:
        border-color 0.15s ease,
        box-shadow 0.15s ease,
        background 0.15s ease;
      width: 100%;
    }

    select:focus,
    input:focus,
    textarea:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 1px var(--accent);
      background: rgba(15, 23, 42, 1);
    }

    textarea {
      min-height: 72px;
      resize: vertical;
    }

    .hint {
      font-size: 0.7rem;
      color: var(--muted);
    }

    .section-divider {
      height: 1px;
      background: linear-gradient(
        to right,
        transparent,
        rgba(75, 85, 99, 0.8),
        transparent
      );
      margin: 6px 0 6px;
    }

    .footer-actions {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 10px;
      padding-top: 8px;
      border-top: 1px dashed rgba(55, 65, 81, 0.7);
      position: relative;
      z-index: 1;
    }

    .btn-row {
      display: flex;
      gap: 8px;
    }

    button {
      border-radius: 999px;
      border: none;
      font-size: 0.82rem;
      padding: 7px 14px;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      font-weight: 500;
      transition:
        background 0.15s ease,
        transform 0.08s ease,
        box-shadow 0.15s ease;
      white-space: nowrap;
    }

    button.primary {
      background: linear-gradient(to right, var(--accent), #22c55e);
      color: #f9fafb;
      box-shadow: 0 8px 22px rgba(15, 23, 42, 0.7);
    }

    button.primary:hover {
      transform: translateY(-1px);
      box-shadow: 0 10px 28px rgba(15, 23, 42, 0.9);
    }

    button.secondary {
      background: rgba(15, 23, 42, 0.9);
      color: var(--muted);
      border: 1px solid rgba(55, 65, 81, 0.9);
    }

    button.secondary:hover {
      background: rgba(31, 41, 55, 1);
      color: #e5e7eb;
    }

    button:disabled {
      opacity: 0.5;
      cursor: default;
      transform: none;
      box-shadow: none;
    }

    .step { display: none; }
    .step.active { display: block; }

    .error {
      font-size: 0.75rem;
      color: var(--danger);
      margin-top: 4px;
    }

    .results-card {
      display: flex;
      flex-direction: column;
      gap: 10px;
      position: relative;
      z-index: 1;
    }

    .results-scroll {
      flex: 1 1 auto;
      max-height: 640px;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .results-footer .action-small {
      font-size: 0.72rem;
      padding: 4px 9px;
    }

    .result-tagline {
      font-size: 0.78rem;
      color: var(--muted);
    }

    .pill-row {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-top: 4px;
    }

    .result-section {
      border-radius: 12px;
      border: 1px solid rgba(75, 85, 99, 0.9);
      background:
        radial-gradient(circle at top left, rgba(148,163,184,0.1), transparent 55%),
        rgba(15, 23, 42, 0.95);
      padding: 10px 11px;
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .result-section h3 {
      margin: 0;
      font-size: 0.9rem;
      letter-spacing: 0.04em;
      text-transform: uppercase;
      color: #d1d5db;
    }

    .result-main { font-size: 0.9rem; }
    .result-main strong { color: #e5e7eb; }

    .result-notes {
      font-size: 0.78rem;
      color: var(--muted);
    }

    .sizing-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 6px;
      font-size: 0.78rem;
    }

    .sizing-table th,
    .sizing-table td {
      border: 1px solid rgba(55, 65, 81, 0.8);
      padding: 4px 6px;
    }

    .sizing-table th {
      text-align: left;
      color: var(--muted);
      font-weight: 500;
    }


    .mini-label {
      font-size: 0.7rem;
      color: var(--muted);
    }

    .howto-list {
      margin: 0;
      padding-left: 18px;
      font-size: 0.85rem;
    }

    .howto-list li {
      margin-bottom: 4px;
    }
  
    /* F5 usage checkbox alignment */
    .multi-checkbox-group {
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      gap: 0.25rem;
    }
    .multi-checkbox-group .checkbox-inline {
      display: flex;
      align-items: center;
      justify-content: flex-start;
      gap: 0.4rem;
      margin: 0;
    }
    .multi-checkbox-group .checkbox-inline input[type="checkbox"] {
      margin: 0;
    }
</style>
</head>
<body>
  <div class="app-shell">
    <header>
      <div>
        <h1>
          <span class="logo-dot"></span>
          Multi-Cloud Decision & Onboarding Wizard
        </h1>
        <p id="cloudSubtitle">
          Currently designing for <strong>Microsoft Azure</strong>. Change the cloud to see different options.
        </p>
      </div>
      <div class="cloud-picker">
        <div class="badge">Version 6.2a · Copright Theodore B.C. Gibson</div>
        <label>
          Cloud:
          <select id="cloudProvider">
            <option value="azure">Microsoft Azure</option>
            <option value="aws">Amazon Web Services (AWS)</option>
            <option value="gcp">Google Cloud Platform (GCP)</option>
            <option value="oci">Oracle Cloud Infrastructure (OCI)</option>
          </select>
        </label>
      </div>
    </header>

    <div class="content">
      <!-- LEFT: Multi-step form -->
      <div class="card">
        <div class="card-header">
          <div>
            <h2 id="step-title">Step 1 · Initiative & basics</h2>
            <div class="step-indicator">
              <span class="step-dot"></span>
              <span id="step-subtitle">New vs existing vs maintenance vs migration, plus workload basics</span>
            </div>
          </div>
          <div class="pill">
            <span id="step-counter">Step 1 of 3</span>
          </div>
        </div>

        <div class="section-divider"></div>

        <!-- STEP 1 -->
        <div id="step-1" class="step active">
          <div class="form-grid">
            <div class="field">
              <label for="initiativeType">
                Initiative type <span class="req">*</span>
              </label>
              <select id="initiativeType">
                <option value="">Select...</option>
                <option value="new-service">New service / greenfield</option>
                <option value="existing-service">Change to existing service</option>
                <option value="maintenance">Maintenance / operations</option>
                <option value="migration">Migration</option>
              </select>
              <div class="hint">
                First decision point: are we creating something new, changing an existing service, maintaining, or migrating?
              </div>
            </div>

            <div class="field">
              <label for="workloadName">
                Workload / initiative name <span class="req">*</span>
              </label>
              <input id="workloadName" type="text" placeholder="e.g. Retail payments API, Claims analytics hub" />
              <div class="hint">Short label so you recognize this initiative in reviews.</div>
            </div>

            <div class="field">
              <label for="architectureType">
                Architecture type
              </label>
              <select id="architectureType">
                <option value="">Select...</option>
                <option value="web-api">Web app / HTTP API</option>
                <option value="microservices">Microservices (containers)</option>
                <option value="batch">Batch / scheduled processing</option>
                <option value="event-driven">Event-driven / reactive</option>
                <option value="legacy-vm">Legacy app / VM-centric</option>
                <option value="data-analytics">Data / analytics platform</option>
              </select>
              <div class="hint">Current or target architecture for this initiative.</div>
            </div>

            <div class="field">
              <label for="trafficPattern">
                Traffic pattern
              </label>
              <select id="trafficPattern">
                <option value="">Select...</option>
                <option value="low">Low, predictable</option>
                <option value="medium">Medium, predictable</option>
                <option value="high">High, 24/7</option>
                <option value="spiky">Spiky / bursty</option>
              </select>
              <div class="hint">Used to push toward serverless vs reserved capacity.</div>
            </div>

            <div class="field">
              <label for="latencySensitivity">
                Latency sensitivity
              </label>
              <select id="latencySensitivity">
                <option value="">Select...</option>
                <option value="strict">Strict (sub-second, customer facing)</option>
                <option value="moderate">Moderate (seconds are fine)</option>
                <option value="relaxed">Relaxed (batch / offline)</option>
              </select>
            </div>

            <div class="field">
              <label for="teamSkills">
                Team strengths
              </label>
              <select id="teamSkills">
                <option value="">Select...</option>
                <option value="vms">VMs / servers</option>
                <option value="containers">Containers / Kubernetes</option>
                <option value="paas">PaaS / managed app platforms</option>
                <option value="serverless">Serverless / functions</option>
              </select>
              <div class="hint">
                Pick the dominant skill pattern; you can note edge cases in the description.
              </div>
            </div>

            <div class="field" style="grid-column: 1 / -1;">
              <label for="description">
                Short description
              </label>
              <textarea id="description" placeholder="What does this initiative do? Who uses it? What problem does it solve?"></textarea>
            </div>
          </div>

          <div id="error-step-1" class="error"></div>
        </div>

        <!-- STEP 2 -->
        <div id="step-2" class="step">
          <!-- Path-specific section -->
          <div class="field">
            <label>
              Path details (depends on initiative type)
            </label>
            <div class="hint">
              Step 2.1: refine what kind of <span id="path-label">initiative</span> this is. Change Step 1 to switch paths.
            </div>
          </div>

          <div id="path-specific-wrapper">
            <!-- New service -->
            <div class="path-group path-grid" id="path-new-service">
              <div class="field">
                <label for="newServiceType">
                  New service type
                </label>
                <select id="newServiceType">
                  <option value="">Select...</option>
                  <option value="customer-facing">Customer-facing app / digital product</option>
                  <option value="internal-lob">Internal line-of-business app</option>
                  <option value="data-analytics-platform">Data / analytics / reporting platform</option>
                  <option value="integration-hub">Integration / API / messaging hub</option>
                  <option value="shared-platform">Shared platform / capability (logging, identity, etc.)</option>
                </select>
              </div>
              <div class="field">
                <label for="newServiceStage">
                  Stage
                </label>
                <select id="newServiceStage">
                  <option value="">Select...</option>
                  <option value="pilot">Pilot / proof-of-concept</option>
                  <option value="new-prod">New production workload</option>
                  <option value="scale-existing">Scaling a successful service</option>
                </select>
              </div>
            </div>

            <!-- Existing service change -->
            <div class="path-group path-grid" id="path-existing-change">
              <div class="field">
                <label for="existingChangeType">
                  Change focus
                </label>
                <select id="existingChangeType">
                  <option value="">Select...</option>
                  <option value="scale-ha">Scale / HA / resilience</option>
                  <option value="features">New features / capabilities</option>
                  <option value="compliance">Compliance / security hardening</option>
                  <option value="cost">Cost optimization / rightsizing</option>
                  <option value="modernization">Modernization / tech-refresh</option>
                  <option value="customer-facing">Customer-facing app / digital product</option>
                  <option value="internal-lob">Internal line-of-business app</option>
                  <option value="data-analytics-platform">Data / analytics / reporting platform</option>
                  <option value="integration-hub">Integration / API / messaging hub</option>
                  <option value="shared-platform">Shared platform / capability (logging, identity, etc.)</option>
                </select>
              </div>
              <div class="field">
                <label for="existingPainPoints">
                  Current pain points
                </label>
                <textarea id="existingPainPoints" placeholder="Incidents, audit findings, performance issues, cost overrun, technical debt, etc."></textarea>
              </div>
            </div>

            <!-- Maintenance / operations -->
            <div class="path-group path-grid" id="path-maintenance">
              <div class="field">
                <label for="maintenanceFocus">
                  Maintenance focus
                </label>
                <select id="maintenanceFocus">
                  <option value="">Select...</option>
                  <option value="patching">Patching & platform updates</option>
                  <option value="performance">Performance tuning / capacity</option>
                  <option value="incident-reduction">Incident reduction / reliability</option>
                  <option value="cost">Cost optimization / housekeeping</option>
                  <option value="slo-reporting">SLOs, reporting & governance</option>
                </select>
              </div>
              <div class="field">
                <label for="maintenanceCadence">
                  Operational cadence
                </label>
                <select id="maintenanceCadence">
                  <option value="">Select...</option>
                  <option value="weekly">Weekly</option>
                  <option value="monthly">Monthly</option>
                  <option value="quarterly">Quarterly</option>
                </select>
              </div>
            </div>

            <!-- Migration -->
            <div class="path-group path-grid" id="path-migration">
              <div class="field">
                <label for="migrationScope">
                  Migration scope
                </label>
                <select id="migrationScope">
                  <option value="">Select...</option>
                  <option value="single-app">Single application / service</option>
                  <option value="portfolio">Portfolio of many apps</option>
                  <option value="dc-estate">Data center / infrastructure estate</option>
                  <option value="db-only">Database-only / data-only migration</option>
                </select>
              </div>
              <div class="field">
                <label for="cutoverStrategy">
                  Cutover strategy
                </label>
                <select id="cutoverStrategy">
                  <option value="">Select...</option>
                  <option value="big-bang">Big-bang cutover</option>
                  <option value="phased">Phased by app / group</option>
                  <option value="bluegreen">Blue/green or parallel run</option>
                  <option value="canary">Canary / cohort-based rollout</option>
                </select>
              </div>
            </div>
          </div>

          <div class="section-divider"></div>

          <!-- Data & sector -->
          <div class="form-grid">
            <div class="field">
              <label for="dataType">
                Primary data pattern <span class="req">*</span>
              </label>
              <select id="dataType">
                <option value="">Select...</option>
                <option value="relational">Relational (OLTP)</option>
                <option value="nosql">NoSQL / document / key-value</option>
                <option value="files">Files / objects / blobs</option>
                <option value="streaming">Streaming / telemetry</option>
                <option value="analytics-lake">Analytics / data lake / warehouse</option>
              </select>
              <div class="hint">Most important data storage pattern.</div>
            </div>

            <div class="field">
              <label for="dataSensitivity">
                Data sensitivity / sector <span class="req">*</span>
              </label>
              <select id="dataSensitivity">
                <option value="">Select...</option>
                <optgroup label="Private Sector">
                  <option value="public">Public / low impact</option>
                  <option value="internal">Internal, non-sensitive</option>
                  <option value="confidential">Confidential business data</option>
                  <option value="regulated">Regulated (PII / NPI / PCI etc.)</option>
                </optgroup>
                <optgroup label="Public Sector (impact levels)">
                  <option value="ps-l2">Public Sector L2</option>
                  <option value="ps-l4">Public Sector L4</option>
                  <option value="ps-l5">Public Sector L5</option>
                  <option value="ps-l6">Public Sector L6</option>
                </optgroup>
              </select>
              <div class="hint">
                Drives region choice (Public Sector L2/L4/L5/L6 vs Private Sector), encryption, private endpoints,
                and which services are allowed for financial & federal workloads.
              </div>
            </div>

            <div class="field">
              <label for="writePattern">
                Write / update pattern
              </label>
              <select id="writePattern">
                <option value="">Select...</option>
                <option value="light">Light writes, mostly reads</option>
                <option value="balanced">Balanced reads and writes</option>
                <option value="heavy-writes">Heavy write / ingest</option>
              </select>
            </div>

            <div class="field">
              <label for="geoPattern">
                Geography / users
              </label>
              <select id="geoPattern">
                <option value="">Select...</option>
                <option value="single-region">Single region / country</option>
                <option value="multi-region">Multi-region in one continent</option>
                <option value="global">Global user base</option>
              </select>
              <div class="hint">For multi-region and CDN decisions.</div>
            </div>

            <div class="field">
              <label for="integrations">
                Integration pattern
              </label>
              <select id="integrations">
                <option value="">Select...</option>
                <option value="simple-http">Simple HTTP calls to a few services</option>
                <option value="enterprise-messaging">Enterprise messaging / async flows</option>
                <option value="event-streaming">Event streaming / telemetry</option>
                <option value="orchestration">Complex workflows / orchestrations</option>
              </select>
            </div>

            <div class="field">
              <label for="complianceNotes">
                Compliance / regulatory notes
              </label>
              <textarea id="complianceNotes" placeholder="e.g. GLBA NPI, PCI, SOX, FFIEC, NIST 800-53, FedRAMP IL4+/IL5/IL6, etc."></textarea>
            </div>
          </div>
          <div id="error-step-2" class="error"></div>
        </div>

        <!-- STEP 3 -->
        <div id="step-3" class="step">
          <div class="form-grid">
            <div class="field">
              <label for="criticality">
                Business criticality <span class="req">*</span>
              </label>
              <select id="criticality">
                <option value="">Select...</option>
                <option value="tier0">Tier 0 – mission critical (customer / revenue)</option>
                <option value="tier1">Tier 1 – important internal</option>
                <option value="tier2">Tier 2/3 – supporting / batch</option>
              </select>
            </div>

            <div class="field">
              <label for="uptimeTarget">
                Uptime target
              </label>
              <select id="uptimeTarget">
                <option value="">Select...</option>
                <option value="99.0">~99.0% (occasional outages tolerated)</option>
                <option value="99.5">~99.5%</option>
                <option value="99.9">~99.9%</option>
                <option value="99.95">99.95%+</option>
              </select>
            </div>

            <div class="field">
              <label for="rto">
                RTO (Recovery Time Objective)
              </label>
              <select id="rto">
                <option value="">Select...</option>
                <option value="mins">Minutes</option>
                <option value="hour">Around 1 hour</option>
                <option value="few-hours">Few hours</option>
                <option value="day-plus">1 day or more</option>
              </select>
            </div>

            <div class="field">
              <label for="rpo">
                RPO (Recovery Point Objective)
              </label>
              <select id="rpo">
                <option value="">Select...</option>
                <option value="zero">Near zero data loss</option>
                <option value="15min">Around 15 minutes</option>
                <option value="hour">Around 1 hour</option>
                <option value="day">Up to 1 day</option>
              </select>
            </div>

            <div class="field">
              <label for="timeToMarket">
                Time-to-market pressure
              </label>
              <select id="timeToMarket">
                <option value="">Select...</option>
                <option value="urgent">Urgent – weeks</option>
                <option value="normal">Normal – few months</option>
                <option value="long">Longer-term – 6+ months</option>
              </select>
              <div class="hint">Managed PaaS / serverless often wins when time is tight.</div>
            </div>

            <div class="field">
              <label for="opsMaturity">
                Ops / SRE maturity
              </label>
              <select id="opsMaturity">
                <option value="">Select...</option>
                <option value="basic">Basic – no real 24/7 ops</option>
                <option value="intermediate">Intermediate – some on-call / runbooks</option>
                <option value="advanced">Advanced – SRE / strong automation</option>
              </select>
            </div>

            <div class="field">
              <label for="sourceEnv">
                Source environment (today)
              </label>
              <select id="sourceEnv">
                <option value="">Select...</option>
                <option value="onprem-vmware">On-prem VMware estate</option>
                <option value="onprem-baremetal">On-prem bare metal / mixed hypervisors</option>
                <option value="existing-dc">Hosted / co-lo data center</option>
                <option value="existing-cloud">Existing cloud (re-platform / multi-cloud)</option>
                <option value="saas">Primarily SaaS integrations</option>
                <option value="hybrid">Hybrid mix of on-prem + cloud</option>
              </select>
              <div class="hint">Used to drive VMware options, migration tooling, and network connectivity.</div>
            </div>

            <div class="field">
              <label for="migrationApproach">
                Migration approach (7R)
              </label>
              <select id="migrationApproach">
                <option value="">Select...</option>
                <option value="rehost">Rehost (lift & shift)</option>
                <option value="replatform">Replatform (minor cloud optimizations)</option>
                <option value="refactor">Refactor / modernize</option>
                <option value="repurchase">Repurchase (SaaS)</option>
                <option value="retain">Retain (stay where it is)</option>
                <option value="retire">Retire (decommission)</option>
                <option value="relocate">Relocate (VMware-as-a-Service)</option>
              </select>
            </div>

            <div class="field">
              <label for="iaCTools">
                IaC / automation tooling
              </label>
              <select id="iaCTools">
                <option value="">Select...</option>
                <option value="terraform">Terraform</option>
                <option value="ansible">Ansible</option>
                <option value="cloud-native">
                  Cloud-native (ARM/Bicep, CloudFormation/CDK, Deployment Manager, OCI Resource Manager)
                </option>
                <option value="jenkins-ado-gha">
                  CI/CD (Jenkins / Azure DevOps / GitHub Actions / CodePipeline / Cloud Build)
                </option>
              </select>
              <div class="hint">
                Pick the primary IaC / automation tool; if you use several, pick the most important one.
              </div>
            </div>

            <div class="field">
              <label for="securityBaseline">
                Security baseline / hardening
              </label>
              <select id="securityBaseline">
                <option value="">Select...</option>
                <option value="standard">Standard enterprise baseline (CIS / internal baseline)</option>
                <option value="regulated">Strict regulated (PCI / PHI / SOX etc.)</option>
                <option value="stig">DoD / STIG-aligned baseline</option>
                <option value="minimal">Minimal baseline / best-effort hardening</option>
              </select>
              <div class="hint">
                Influences how opinionated the security and controls guidance is (CIS, STIG, etc.).
              </div>
            </div>

            <div class="field">
              <label for="identityModel">
                Identity &amp; access model
              </label>
              <select id="identityModel">
                <option value="">Select...</option>
                <option value="cloud-iam-only">Cloud-native IAM only</option>
                <option value="hybrid-ad-entra">Hybrid AD / Entra / on-prem IdP</option>
                <option value="external-idp-plus-iam">External IdP (Okta / Ping etc.) + cloud IAM</option>
              </select>
              <div class="hint">
                Used to steer identity, SSO, and least-privilege access guidance.
              </div>
            </div>

            <div class="field">
              <label for="secretsModel">
                Secrets &amp; keys
              </label>
              <select id="secretsModel">
                <option value="">Select...</option>
                <option value="basic">Basic secrets in config / parameter store</option>
                <option value="secrets-manager">Cloud-native secrets manager</option>
                <option value="hsm-backed">HSM-backed keys / dedicated KMS</option>
              </select>
              <div class="hint">
                Covers where app secrets and keys live and how strongly they are protected.
              </div>
            </div>

            <div class="field">
              <label for="dataProtection">
                Data protection level
              </label>
              <select id="dataProtection">
                <option value="">Select...</option>
                <option value="at-rest">At-rest encryption only</option>
                <option value="in-transit-and-at-rest">In-transit + at-rest (TLS everywhere)</option>
                <option value="field-level">Field-level / tokenization / anonymization</option>
              </select>
              <div class="hint">
                Helps tune recommendations for TLS, tokenization, anonymization, and privacy controls.
              </div>
            </div>

            <div class="field">
              <label for="perimeterPattern">
                Perimeter &amp; firewall pattern
              </label>
              <select id="perimeterPattern">
                <option value="">Select...</option>
                <option value="cloud-fw-only">Cloud-native firewall / WAF only</option>
                <option value="cloud-plus-f5">Cloud-native + F5 (ADC / WAF)</option>
                <option value="f5-centric">F5-centric perimeter (BIG-IP / NGINX / XC)</option>
                <option value="legacy-fw">Legacy on-prem firewall in the path</option>
              </select>
              <div class="hint">
                Helps shape guidance across cloud-native firewalls, WAF, and F5 services.
              </div>
            </div>

            <div class="field">
              <label for="f5Usage">
                F5 usage focus
              </label>
              <div class="multi-checkbox-group" id="f5UsageGroup">
                <label class="checkbox-inline">
                  <input type="checkbox" name="f5Usage" value="waap-web" />
                  WAAP / WAF for web apps
                </label>
                <label class="checkbox-inline">
                  <input type="checkbox" name="f5Usage" value="api-security" />
                  API security / API gateway
                </label>
                <label class="checkbox-inline">
                  <input type="checkbox" name="f5Usage" value="ddos" />
                  DDoS protection
                </label>
                <label class="checkbox-inline">
                  <input type="checkbox" name="f5Usage" value="gslb" />
                  GSLB / global traffic management
                </label>
                <label class="checkbox-inline">
                  <input type="checkbox" name="f5Usage" value="service-mesh" />
                  Service mesh / east-west L7
                </label>
                <label class="checkbox-inline">
                  <input type="checkbox" name="f5Usage" value="remote-access" />
                  Remote access / ZTNA / VPN replacement
                </label>
              </div>
              <div class="hint">
                Choose how you expect to use F5 capabilities for this workload (edge WAAP, API security, DDoS, etc.).
              </div>
            </div>

            <div class="field">
              <label for="secOpsMaturity">
                Security operations &amp; monitoring
              </label>
              <select id="secOpsMaturity">
                <option value="">Select...</option>
                <option value="basic">Basic logging only</option>
                <option value="central-siem">Central SIEM/SOC, alerts triaged</option>
                <option value="mature-devsecops">Mature SecOps &amp; DevSecOps (SOAR, shift-left, continuous testing)</option>
              </select>
              <div class="hint">
                Used to tailor recommendations for SIEM/SOC, F5 telemetry, and DevSecOps practices.
              </div>
            </div>
          </div>
          <div id="error-step-3" class="error"></div>
        </div>


        <!-- STEP 4 -->
        <div id="step-4" class="step">
          <div class="form-grid">

            <div class="field-group-title">Sizing & environments</div>

            <div class="field">
              <label for="peakUsers">
                Peak concurrent users
              </label>
              <input id="peakUsers" type="number" min="0" placeholder="e.g. 5000" />
              <div class="hint">Ballpark only – just enough to drive T-shirt sizing.</div>
            </div>

            <div class="field">
              <label for="peakRps">
                Peak requests per second
              </label>
              <input id="peakRps" type="number" min="0" placeholder="e.g. 200" />
              <div class="hint">API / web calls at peak period. Leave blank if unknown.</div>
            </div>

            <div class="field">
              <label for="dataVolumeBand">
                Total data volume (band)
              </label>
              <select id="dataVolumeBand">
                <option value="">Select...</option>
                <option value="xs">XS – &lt; 100 GB</option>
                <option value="s">S – 100 GB – 1 TB</option>
                <option value="m">M – 1 TB – 5 TB</option>
                <option value="l">L – 5 TB – 20 TB</option>
                <option value="xl">XL – 20 TB+</option>
              </select>
            </div>

            <div class="field">
              <label for="dailyIngestBand">
                Daily ingest / change volume
              </label>
              <select id="dailyIngestBand">
                <option value="">Select...</option>
                <option value="light">Light – &lt; 10 GB/day</option>
                <option value="medium">Medium – 10–100 GB/day</option>
                <option value="heavy">Heavy – 100 GB–1 TB/day</option>
                <option value="very-heavy">Very heavy – 1 TB+/day</option>
              </select>
            </div>

            <div class="field">
              <label for="retentionPeriod">
                Data retention target
              </label>
              <select id="retentionPeriod">
                <option value="">Select...</option>
                <option value="short">Short – &lt; 3 months</option>
                <option value="standard">Standard – 3–24 months</option>
                <option value="long">Long – 2–7 years</option>
                <option value="very-long">Very long / archival – 7+ years</option>
              </select>
            </div>

            <div class="field">
              <label>
                Environments in scope
              </label>
              <div>
                <label><input type="checkbox" name="envScope" value="dev"> Dev</label><br>
                <label><input type="checkbox" name="envScope" value="test"> Test</label><br>
                <label><input type="checkbox" name="envScope" value="stage"> Pre-prod / Stage</label><br>
                <label><input type="checkbox" name="envScope" value="prod"> Prod</label><br>
                <label><input type="checkbox" name="envScope" value="dr"> DR</label>
              </div>
              <div class="hint">Tick the environments you actually plan to stand up.</div>
            </div>

            <div class="field">
              <label for="nonProdScale">
                Non-prod scale vs prod
              </label>
              <select id="nonProdScale">
                <option value="">Select...</option>
                <option value="full">Roughly same as prod</option>
                <option value="half">~50% of prod</option>
                <option value="quarter">~25% of prod</option>
                <option value="minimal">Small / shared sandboxes</option>
              </select>
              <div class="hint">Used to size dev / test / stage relative to production.</div>
            </div>

            <div class="field">
              <label for="regionCount">
                Regions / sovereign sites
              </label>
              <select id="regionCount">
                <option value="">Select...</option>
                <option value="1">Single region</option>
                <option value="1-ha">Single region, multi-AZ / zone</option>
                <option value="2">Two regions (active/passive)</option>
                <option value="2-active">Two regions (active/active)</option>
                <option value="3plus">Three+ regions / global</option>
              </select>
            </div>

          </div>

          <div id="error-step-4" class="error"></div>
        </div>

        <!-- Footer buttons -->
        <div class="footer-actions">
          <div class="mini-label" id="mini-hint">
            Step 1 · Pick initiative type and capture basics.
          </div>
          <div class="btn-row">
            <button id="backBtn" class="secondary" type="button">
              ← Back
            </button>
            <button id="nextBtn" class="primary" type="button">
              Next →
            </button>
          </div>
        </div>
      </div>

      <!-- RIGHT: Results panel -->
      <div class="card">
        <div class="card-header">
          <div>
            <h2><span id="cloudTitle">Azure</span> recommendation</h2>
            <div class="step-indicator">
              <span class="step-dot"></span>
              <span>Based on your answers so far</span>
            </div>
          </div>
          <div class="badge-cloud" id="cloudBadge">Azure</div>
        </div>

        <div class="section-divider"></div>

        <div class="results-card">
          <div class="results-scroll">
          <div class="result-tagline">
            Complete all 3 steps and click <strong>Generate recommendation</strong> (or <strong>Finish</strong>) to see suggested services,
            migration path, and a full onboarding playbook for the selected cloud.
          </div>
          <div class="pill-row" id="summaryPills"></div>

          <div id="resultsContent" style="display:none;">
            <div class="result-section">
              <h3>Compute pattern</h3>
              <div class="result-main" id="computeMain"></div>
              <div class="result-notes" id="computeNotes"></div>
            </div>

            <div class="result-section">
              <h3>Data & storage</h3>
              <div class="result-main" id="dataMain"></div>
              <div class="result-notes" id="dataNotes"></div>
            </div>

            <div class="result-section">
              <h3>Integration & messaging</h3>
              <div class="result-main" id="integrationMain"></div>
              <div class="result-notes" id="integrationNotes"></div>
            </div>

            <div class="result-section">
              <h3>Ops, resilience & governance</h3>
              <div class="result-main" id="opsMain"></div>
              <div class="result-notes" id="opsNotes"></div>
            </div>

            <div class="result-section">
              <h3>Security &amp; network controls</h3>
              <div class="result-main" id="securityMain"></div>
              <div class="result-notes" id="securityNotes"></div>
            </div>

            <div class="result-section">
              <h3>Migration & onboarding focus</h3>
              <div class="result-main" id="migrationMain"></div>
              <div class="result-notes" id="migrationNotes"></div>
            </div>

            
            <div class="result-section">
              <h3>Assumptions &amp; gaps</h3>
              <div class="result-main" id="assumptionsMain"></div>
            </div>

            <div class="result-section">
              <h3>Sizing & environment footprint</h3>
              <div class="result-main" id="sizingMain"></div>
              <div class="result-notes" id="sizingNotes"></div>
              <div id="sizingMatrix"></div>
            </div>

<div class="result-section">
              <h3>Implementation playbook · copy into Word</h3>
              <div class="result-main" id="howToMain"></div>
              <div class="result-notes" id="howToNotes">
                This is an end-to-end, multi-phase plan (intake → requirements → architecture → migration → security/ATO → cutover → monitoring → sustainment).
                It assumes you’ll also track artifacts in your CCoE proposal and onboarding checklists.
              </div>
            </div>
          </div>
          </div>

          <div class="footer-actions results-footer" style="padding-top: 10px; border-top: none;">
            <div class="btn-row">
              <button id="fullViewBtn" class="secondary action-small" type="button" disabled>
                Full view
              </button>
              <button id="printBtn" class="secondary action-small" type="button" disabled>
                Print
              </button>
              <button id="exportWordBtn" class="secondary action-small" type="button" disabled>
                Save as Word
              </button>
              <button id="generateBtn" class="primary" type="button">
                Generate recommendation
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    let currentStep = 1;
    let currentCloud = "azure";

    function getMultiSelectValues(select) {
      if (!select) return [];
      return Array.from(select.options)
        .filter(o => o.selected)
        .map(o => o.value);
    }


    function getCheckedValues(name) {
      const nodes = document.querySelectorAll('input[name="' + name + '"]:checked');
      return Array.from(nodes).map(n => n.value);
    }

    function onCloudChange() {
      const select = document.getElementById("cloudProvider");
      if (!select) return;

      currentCloud = select.value;
      const label = select.options[select.selectedIndex].text;

      const cloudTitle = document.getElementById("cloudTitle");
      const cloudBadge = document.getElementById("cloudBadge");
      const subtitle = document.getElementById("cloudSubtitle");
      const root = document.documentElement;

      const shortLabel = label.split(" ")[0];
      if (cloudTitle) cloudTitle.textContent = shortLabel;
      if (cloudBadge) cloudBadge.textContent = shortLabel;

      if (currentCloud === "azure") {
        root.style.setProperty("--accent", "#6366f1");
        root.style.setProperty("--accent-soft", "rgba(99,102,241,0.15)");
        if (subtitle) {
          subtitle.innerHTML = "Currently designing for <strong>Microsoft Azure</strong>.";
        }
      } else if (currentCloud === "aws") {
        root.style.setProperty("--accent", "#f97316");
        root.style.setProperty("--accent-soft", "rgba(249,115,22,0.15)");
        if (subtitle) {
          subtitle.innerHTML = "Currently designing for <strong>Amazon Web Services (AWS)</strong>.";
        }
      } else if (currentCloud === "gcp") {
        root.style.setProperty("--accent", "#22c55e");
        root.style.setProperty("--accent-soft", "rgba(34,197,94,0.15)");
        if (subtitle) {
          subtitle.innerHTML = "Currently designing for <strong>Google Cloud Platform (GCP)</strong>.";
        }
      } else if (currentCloud === "oci") {
        root.style.setProperty("--accent", "#0ea5e9");
        root.style.setProperty("--accent-soft", "rgba(14,165,233,0.15)");
        if (subtitle) {
          subtitle.innerHTML = "Currently designing for <strong>Oracle Cloud Infrastructure (OCI)</strong>.";
        }
      }
    }

    function updatePathGroups() {
      const typeSelect = document.getElementById("initiativeType");
      const pathLabel = document.getElementById("path-label");
      const type = typeSelect ? typeSelect.value : "";

      const groups = {
        "new-service": "path-new-service",
        "existing-service": "path-existing-change",
        "maintenance": "path-maintenance",
        "migration": "path-migration"
      };

      Object.values(groups).forEach(id => {
        const el = document.getElementById(id);
        if (el) el.classList.remove("active");
      });

      let human = "initiative";
      if (type === "new-service") human = "new service";
      else if (type === "existing-service") human = "existing service change";
      else if (type === "maintenance") human = "maintenance / operations";
      else if (type === "migration") human = "migration";

      if (pathLabel) pathLabel.textContent = human;

      const groupId = groups[type];
      if (groupId) {
        const activeEl = document.getElementById(groupId);
        if (activeEl) activeEl.classList.add("active");
      }
    }

    
    function updateStepHeader() {
      const titleEl = document.getElementById("step-title");
      const subtitleEl = document.getElementById("step-subtitle");
      const counterEl = document.getElementById("step-counter");
      const miniHint = document.getElementById("mini-hint");

      if (!titleEl || !subtitleEl || !counterEl || !miniHint) return;

      if (currentStep === 1) {
        titleEl.textContent = "Step 1 · Initiative & basics";
        subtitleEl.textContent = "New vs existing vs maintenance vs migration, plus workload basics";
        counterEl.textContent = "Step 1 of 4";
        miniHint.textContent = "Step 1 · Pick initiative type and capture basics.";
      } else if (currentStep === 2) {
        titleEl.textContent = "Step 2 · Path details & data";
        subtitleEl.textContent = "Details for the chosen initiative type plus data, sector and integration pattern";
        counterEl.textContent = "Step 2 of 4";
        miniHint.textContent = "Step 2 · Refine the path type and describe data, sector and integrations.";
      } else if (currentStep === 3) {
        titleEl.textContent = "Step 3 · Non-functional, security & migration tooling";
        subtitleEl.textContent = "Criticality, SLOs, security baseline, source environment, 7R approach and automation tools";
        counterEl.textContent = "Step 3 of 4";
        miniHint.textContent = "Step 3 · How critical it is and how you will move & run it.";
      } else if (currentStep === 4) {
        titleEl.textContent = "Step 4 · Sizing & environments";
        subtitleEl.textContent = "Traffic band, data volume, environments in scope and regions for this workload";
        counterEl.textContent = "Step 4 of 4";
        miniHint.textContent = "Step 4 · Capture sizing bands and environments before generating the playbook.";
      }
    }

    function showStep(step) {
      currentStep = step;
      const steps = document.querySelectorAll(".step");
      steps.forEach(s => s.classList.remove("active"));
      const stepEl = document.getElementById("step-" + step);
      if (stepEl) stepEl.classList.add("active");

      const backBtn = document.getElementById("backBtn");
      const nextBtn = document.getElementById("nextBtn");

      if (backBtn) backBtn.disabled = step === 1;
      if (nextBtn) {
        nextBtn.textContent = (step === 4) ? "Finish" : "Next →";
      }

      if (step === 2) {
        updatePathGroups();
      }

      updateStepHeader();
    }

    function clearErrors() {
      ["error-step-1", "error-step-2", "error-step-3", "error-step-4"].forEach(id => {
        const el = document.getElementById(id);
        if (el) el.textContent = "";
      });
    }

    function validateStep(step) {
      clearErrors();
      let missing = [];

      if (step === 1) {
        const initiativeType = document.getElementById("initiativeType").value;
        const workloadName = document.getElementById("workloadName").value.trim();
        const architectureType = document.getElementById("architectureType").value;
        const trafficPattern = document.getElementById("trafficPattern").value;
        const latencySensitivity = document.getElementById("latencySensitivity").value;
        const teamSkills = getMultiSelectValues(document.getElementById("teamSkills"));

        if (!initiativeType) missing.push("Initiative type");
        if (!workloadName) missing.push("Workload / initiative name");
        if (!architectureType) missing.push("Architecture type");
        if (!trafficPattern) missing.push("Traffic pattern");
        if (!latencySensitivity) missing.push("Latency sensitivity");
        if (teamSkills.length === 0) missing.push("Team strengths");

        if (missing.length > 0) {
          const el = document.getElementById("error-step-1");
          if (el) el.textContent =
            "Missing: " + missing.join(", ") + ". You can continue, but recommendations will be more generic.";
        }

      } else if (step === 2) {
        const dataType = document.getElementById("dataType").value;
        const dataSensitivity = document.getElementById("dataSensitivity").value;

        if (!dataType || !dataSensitivity) {
          const el = document.getElementById("error-step-2");
          if (el) el.textContent =
            "Set at least primary data pattern and data sensitivity / sector for better recommendations.";
        }

      } else if (step === 3) {
        const criticality = document.getElementById("criticality").value;
        const iaCTools = getMultiSelectValues(document.getElementById("iaCTools"));

        if (!criticality || iaCTools.length === 0) {
          const el = document.getElementById("error-step-3");
          if (el) el.textContent =
            "Business criticality and IaC / automation tooling are empty. Set them to drive HA/DR, migration and automation guidance.";
        }

      } else if (step === 4) {
        const envChecked = document.querySelectorAll('input[name="envScope"]:checked').length;
        if (!envChecked) {
          const el = document.getElementById("error-step-4");
          if (el) el.textContent =
            "Select at least one environment (typically Prod plus Dev/Test) for meaningful sizing guidance.";
        }
      }

      return true; // soft validation only
    }

    function goNext() {
      if (!validateStep(currentStep)) return;

      if (currentStep < 4) {
        showStep(currentStep + 1);
      } else {
        generateRecommendation();
      }
    }

function goBack() {
      if (currentStep > 1) {
        showStep(currentStep - 1);
      }
    }

    function buildSummaryPills(state) {
      const pills = [];

      if (state.workloadName) pills.push("Workload: " + state.workloadName);

      const pathMap = {
        "new-service": "New service",
        "existing-service": "Existing service change",
        "maintenance": "Maintenance / operations",
        "migration": "Migration"
      };
      if (state.initiativeType) {
        const label = pathMap[state.initiativeType] || state.initiativeType;
        pills.push("Path: " + label);
      }

      // Path-specific detail
      if (state.initiativeType === "new-service" && state.newServiceType) {
        const nsMap = {
          "customer-facing": "Customer-facing app",
          "internal-lob": "Internal LOB app",
          "data-analytics-platform": "Data / analytics platform",
          "integration-hub": "Integration / API hub",
          "shared-platform": "Shared platform"
        };
        pills.push("New type: " + (nsMap[state.newServiceType] || state.newServiceType));
      }
      if (state.initiativeType === "existing-service" && state.existingChangeType) {
        const ecMap = {
          "scale-ha": "Scale / resilience",
          "features": "New features",
          "compliance": "Compliance & security",
          "cost": "Cost optimization",
          "modernization": "Modernization",
          "customer-facing": "Customer-facing app",
          "internal-lob": "Internal LOB app",
          "data-analytics-platform": "Data / analytics platform",
          "integration-hub": "Integration / API hub",
          "shared-platform": "Shared platform"
        };
        pills.push("Change: " + (ecMap[state.existingChangeType] || state.existingChangeType));
      }
      if (state.initiativeType === "maintenance" && state.maintenanceFocus) {
        const mfMap = {
          "patching": "Patching & updates",
          "performance": "Performance tuning",
          "incident-reduction": "Incident reduction",
          "cost": "Cost & housekeeping",
          "slo-reporting": "SLOs & reporting"
        };
        pills.push("Ops focus: " + (mfMap[state.maintenanceFocus] || state.maintenanceFocus));
      }
      if (state.initiativeType === "migration" && state.migrationScope) {
        const msMap = {
          "single-app": "Single app",
          "portfolio": "App portfolio",
          "dc-estate": "DC / estate",
          "db-only": "DB/data-only"
        };
        pills.push("Migration scope: " + (msMap[state.migrationScope] || state.migrationScope));
      }

      if (state.architectureType) pills.push("Architecture: " + state.architectureType);
      if (state.dataType) pills.push("Data: " + state.dataType);
      if (state.dataSensitivity) pills.push("Sensitivity: " + state.dataSensitivity);
      if (state.criticality) pills.push("Criticality: " + state.criticality);
      if (state.sourceEnv) pills.push("Source: " + state.sourceEnv);
      if (state.migrationApproach) pills.push("7R: " + state.migrationApproach);
      if (state.iaCTools && state.iaCTools.length > 0) pills.push("IaC: " + state.iaCTools.join(", "));
      return pills;
    }

    
    
    function buildRecommendationDocumentHtml() {
      const providerSelect = document.getElementById("cloudProvider");
      const providerLabel = providerSelect
        ? providerSelect.options[providerSelect.selectedIndex].text
        : "";
      const workloadNameInput = document.getElementById("workloadName");
      const workloadName = workloadNameInput && workloadNameInput.value
        ? workloadNameInput.value
        : "Cloud workload";
      const summaryPills = document.getElementById("summaryPills");
      const resultsContent = document.getElementById("resultsContent");
      const now = new Date();
      const generatedAt = now.toLocaleString();

      // Pull current wizard state for brief F5 posture line
      const state = (function () {
        const envScope = Array.from(
          document.querySelectorAll('input[name="envScope"]:checked')
        ).map(c => c.value);

        return {
          f5Usage: window.getCheckedValues
            ? window.getCheckedValues("f5Usage")
            : [],
          perimeterPattern: document.getElementById("perimeterPattern")
            ? document.getElementById("perimeterPattern").value
            : "",
          criticality: document.getElementById("criticality")
            ? document.getElementById("criticality").value
            : "",
          dataSensitivity: document.getElementById("dataSensitivity")
            ? document.getElementById("dataSensitivity").value
            : "",
          envScope
        };
      })();

      let pillsLine = "";
      if (summaryPills) {
        const spans = Array.from(summaryPills.querySelectorAll("span"));
        pillsLine = spans.map(s => s.textContent).join(" | ");
      }

      const resultsHtml = resultsContent && resultsContent.style.display !== "none"
        ? resultsContent.innerHTML
        : "<p>No recommendation has been generated yet.</p>";

      
      let f5PostureLine = "";
      if (state) {
        const usage = Array.isArray(state.f5Usage) ? state.f5Usage : [];
        const postureBits = [];

        const isRegulated =
          state.dataSensitivity === "regulated" ||
          state.dataSensitivity === "ps-l2" ||
          state.dataSensitivity === "ps-l4" ||
          state.dataSensitivity === "ps-l5" ||
          state.dataSensitivity === "ps-l6";

        if (usage.indexOf("waap-web") !== -1 || usage.indexOf("api-security") !== -1) {
          postureBits.push("F5 front-door protection for web and/or API traffic");
        }
        if (usage.indexOf("ddos") !== -1) {
          postureBits.push("F5 DDoS protection on critical internet-facing endpoints");
        }
        if (usage.indexOf("gslb") !== -1) {
          postureBits.push("F5 DNS / GSLB for cross-region traffic steering");
        }
        if (usage.indexOf("service-mesh") !== -1) {
          postureBits.push("F5 applied to east–west / service-mesh traffic patterns");
        }
        if (usage.indexOf("remote-access") !== -1) {
          postureBits.push("F5 secure remote access / ZTNA as VPN successor");
        }

        if (!postureBits.length && state.perimeterPattern === "cloud-plus-f5") {
          postureBits.push("F5 layered with cloud-native firewalls as part of the perimeter");
        } else if (!postureBits.length && state.perimeterPattern === "f5-centric") {
          postureBits.push("F5 as the primary perimeter / WAAP tier");
        }

        if (postureBits.length) {
          const focus = postureBits.join("; ");
          const criticalityLabel =
            state.criticality === "tier0"
              ? "Tier 0"
              : state.criticality === "tier1"
              ? "Tier 1"
              : state.criticality === "tier2"
              ? "Tier 2/3"
              : "mixed criticality";

          const sectorTag = isRegulated ? "regulated / public-sector context" : "commercial context";

          f5PostureLine =
            "<p><strong>F5 posture:</strong> " +
            focus +
            " (" +
            criticalityLabel +
            ", " +
            sectorTag +
            ").</p>";
        }
      }

      const docBody = `
        <h1>Cloud Recommendation for ${workloadName}</h1>
        <p><strong>Cloud:</strong> ${providerLabel}</p>
        <p><strong>Generated:</strong> ${generatedAt}</p>
        ${pillsLine ? `<p><strong>Summary:</strong> ${pillsLine}</p>` : ""}
        ${f5PostureLine || ""}
        ${resultsHtml}
      `;

      const fullHtml = `<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>Cloud Recommendation</title>
  <style>
    body { font-family: Arial, sans-serif; font-size: 11pt; line-height: 1.4; margin: 20px; }
    h1 { font-size: 20pt; margin-bottom: 8px; }
    h3 { margin-top: 18px; font-size: 12pt; }
    p { margin: 4px 0; }
    table { border-collapse: collapse; margin-top: 6px; }
    table, th, td { border: 1px solid #555; }
    th, td { padding: 4px 6px; }
  </style>
</head>
<body>
${docBody}
</body>
</html>`;
      return fullHtml;
    }

    function openFullViewWindow() {
      const html = buildRecommendationDocumentHtml();
      const w = window.open("", "_blank");
      if (!w) return;
      w.document.open();
      w.document.write(html);
      w.document.close();
      w.focus();
    }

    function openPrintView() {
      const html = buildRecommendationDocumentHtml();
      const w = window.open("", "_blank");
      if (!w) return;
      w.document.open();
      w.document.write(html);
      w.document.close();
      w.focus();
      w.print();
    }

    function exportRecommendationAsWord() {
      const html = buildRecommendationDocumentHtml();
      const blob = new Blob(['\ufeff', html], { type: "application/msword" });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      const workloadNameInput = document.getElementById("workloadName");
      let fileBase = workloadNameInput && workloadNameInput.value
        ? workloadNameInput.value
        : "cloud-recommendation";
      fileBase = fileBase.toLowerCase()
        .replace(/[^a-z0-9]+/g, "-")
        .replace(/-+/g, "-")
        .replace(/^-|-$/g, "");
      a.href = url;
      a.download = (fileBase || "cloud-recommendation") + "-recommendation.doc";
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
    }

    
    function buildAssumptionsAndGaps(state, cloud) {
      const {
        criticality,
        uptimeTarget,
        rto,
        rpo,
        dataSensitivity,
        securityBaseline,
        secOpsMaturity,
        geoPattern,
        regionCount
      } = state;

      const bullets = [];

      // Criticality vs availability
      if ((criticality === "tier0" || criticality === "tier1") && (!uptimeTarget || uptimeTarget === "99.9")) {
        bullets.push("High criticality (Tier 0/1) with a relatively weak uptime target – confirm if HA and DR are sufficient.");
      }

      // DR vs geography
      const multiRegion =
        geoPattern === "multi-region" ||
        regionCount === "2" ||
        regionCount === "2-active" ||
        regionCount === "3plus";

      if ((criticality === "tier0" || criticality === "tier1") && !multiRegion) {
        bullets.push("Tier 0/1 without multi-region or an explicit DR region – confirm that single-region risk is acceptable.");
      }

      // Regulated vs baseline / SecOps
      const regulated =
        dataSensitivity === "regulated" ||
        dataSensitivity === "ps-l2" ||
        dataSensitivity === "ps-l4" ||
        dataSensitivity === "ps-l5" ||
        dataSensitivity === "ps-l6";

      if (regulated && securityBaseline === "minimal") {
        bullets.push("Regulated or public-sector data with a minimal security baseline – likely not acceptable; align to CIS/STIG or an equivalent control set.");
      }

      if (regulated && secOpsMaturity === "basic") {
        bullets.push("Regulated data with only basic logging – SOC/SIEM coverage, alerting, and runbooks likely need to be strengthened.");
      }

      if (!bullets.length) {
        return "Assumptions look consistent with the selected criticality, DR, and security posture. Use this as a starting point for deeper design reviews.";
      }

      const items = bullets.map(b => "<li>" + b + "</li>").join("");
      return "<ul>" + items + "</ul>";
    }


    function generateRecommendation() {
      const envScope = Array.from(
        document.querySelectorAll('input[name="envScope"]:checked')
      ).map(c => c.value);

      const state = {
        initiativeType: document.getElementById("initiativeType").value,
        newServiceType: document.getElementById("newServiceType").value,
        newServiceStage: document.getElementById("newServiceStage").value,
        existingChangeType: document.getElementById("existingChangeType").value,
        existingPainPoints: (document.getElementById("existingPainPoints").value || "").trim(),
        maintenanceFocus: document.getElementById("maintenanceFocus").value,
        maintenanceCadence: document.getElementById("maintenanceCadence").value,
        migrationScope: document.getElementById("migrationScope").value,
        cutoverStrategy: document.getElementById("cutoverStrategy").value,

        workloadName: (document.getElementById("workloadName").value || "").trim(),
        architectureType: document.getElementById("architectureType").value,
        trafficPattern: document.getElementById("trafficPattern").value,
        latencySensitivity: document.getElementById("latencySensitivity").value,
        teamSkills: getMultiSelectValues(document.getElementById("teamSkills")),
        description: (document.getElementById("description").value || "").trim(),

        dataType: document.getElementById("dataType").value,
        dataSensitivity: document.getElementById("dataSensitivity").value,
        writePattern: document.getElementById("writePattern").value,
        geoPattern: document.getElementById("geoPattern").value,
        integrations: document.getElementById("integrations").value,
        complianceNotes: (document.getElementById("complianceNotes").value || "").trim(),

        criticality: document.getElementById("criticality").value,
        uptimeTarget: document.getElementById("uptimeTarget").value,
        rto: document.getElementById("rto").value,
        rpo: document.getElementById("rpo").value,
        timeToMarket: document.getElementById("timeToMarket").value,
        opsMaturity: document.getElementById("opsMaturity").value,
        securityBaseline: document.getElementById("securityBaseline").value,
        identityModel: document.getElementById("identityModel").value,
        secretsModel: document.getElementById("secretsModel").value,
        dataProtection: document.getElementById("dataProtection").value,
        perimeterPattern: document.getElementById("perimeterPattern").value,
        f5Usage: getCheckedValues("f5Usage"),
        secOpsMaturity: document.getElementById("secOpsMaturity").value,

        sourceEnv: document.getElementById("sourceEnv").value,
        migrationApproach: document.getElementById("migrationApproach").value,
        iaCTools: getMultiSelectValues(document.getElementById("iaCTools")),

        peakUsers: Number(document.getElementById("peakUsers").value || 0),
        peakRps: Number(document.getElementById("peakRps").value || 0),
        dataVolumeBand: document.getElementById("dataVolumeBand").value,
        dailyIngestBand: document.getElementById("dailyIngestBand").value,
        retentionPeriod: document.getElementById("retentionPeriod").value,
        envScope,
        nonProdScale: document.getElementById("nonProdScale").value,
        regionCount: document.getElementById("regionCount").value
      };

      const pillRow = document.getElementById("summaryPills");
      if (pillRow) {
        pillRow.innerHTML = "";
        const pills = buildSummaryPills(state);
        pills.forEach(text => {
          const span = document.createElement("span");
          span.className = "pill";
          span.textContent = text;
          pillRow.appendChild(span);
        });
      }

      const rec = generateCloudRecommendation(currentCloud, state);
      const howTo = buildHowToPlaybook(currentCloud, state);
      const sizing = buildSizingPlan(currentCloud, state);
      const assumptions = buildAssumptionsAndGaps(state, currentCloud);

      const resultsContent = document.getElementById("resultsContent");
      if (resultsContent) resultsContent.style.display = "block";
      const fullBtn = document.getElementById("fullViewBtn");
      const printBtn = document.getElementById("printBtn");
      const wordBtn = document.getElementById("exportWordBtn");
      [fullBtn, printBtn, wordBtn].forEach(btn => {
        if (btn) btn.disabled = false;
      });


      const mapping = [
        ["computeMain", rec.computeMain],
        ["computeNotes", rec.computeNotes],
        ["dataMain", rec.dataMain],
        ["dataNotes", rec.dataNotes],
        ["integrationMain", rec.integMain],
        ["integrationNotes", rec.integNotes],
        ["opsMain", rec.opsMain],
        ["opsNotes", rec.opsNotes],
        ["securityMain", rec.securityMain],
        ["securityNotes", rec.securityNotes],
        ["migrationMain", rec.migrationMain],
        ["migrationNotes", rec.migrationNotes],
        ["sizingMain", sizing.main],
        ["sizingNotes", sizing.notes],
        ["sizingMatrix", sizing.matrixHtml],
        ["howToMain", howTo],
        ["assumptionsMain", assumptions]
      ];

      mapping.forEach(([id, html]) => {
        const el = document.getElementById(id);
        if (el) el.innerHTML = html || "";
      });
    }

function generateCloudRecommendation(cloud, state) {
      const {
        initiativeType,
        newServiceType,
        newServiceStage,
        existingChangeType,
        maintenanceFocus,
        migrationScope,
        cutoverStrategy,
        architectureType,
        trafficPattern,
        latencySensitivity,
        teamSkills,
        dataType,
        dataSensitivity,
        writePattern,
        geoPattern,
        integrations,
        criticality,
        uptimeTarget,
        rto,
        rpo,
        timeToMarket,
        opsMaturity,
        securityBaseline,
        identityModel,
        secretsModel,
        dataProtection,
        perimeterPattern,
        f5Usage,
        secOpsMaturity,
        sourceEnv,
        migrationApproach,
        iaCTools
      } = state;

      const hasSkill = s => teamSkills.indexOf(s) !== -1;
      const usesIaC = t => iaCTools.indexOf(t) !== -1;

      const regulated =
        dataSensitivity === "regulated" ||
        dataSensitivity === "ps-l2" ||
        dataSensitivity === "ps-l4" ||
        dataSensitivity === "ps-l5" ||
        dataSensitivity === "ps-l6";

      const isPublicSector =
        dataSensitivity === "ps-l2" ||
        dataSensitivity === "ps-l4" ||
        dataSensitivity === "ps-l5" ||
        dataSensitivity === "ps-l6";

      const isPrivateSector =
        dataSensitivity === "public" ||
        dataSensitivity === "internal" ||
        dataSensitivity === "confidential" ||
        dataSensitivity === "regulated";

      const tierLabel =
        criticality === "tier0"
          ? "Tier 0 – mission critical"
          : criticality === "tier1"
          ? "Tier 1 – important internal"
          : criticality === "tier2"
          ? "Tier 2/3 – supporting / batch"
          : "Unspecified";

      const providerName =
        cloud === "azure" ? "Azure" :
        cloud === "aws"   ? "AWS" :
        cloud === "gcp"   ? "Google Cloud" :
                            "Oracle Cloud Infrastructure";

      let computeMain = "General-purpose compute with managed load balancing.";
      let computeNotes = "";
      let dataMain = "Baseline managed data services.";
      let dataNotes = "";
      let integMain = "Standard API gateway and messaging services.";
      let integNotes = "";
      let opsMain = "Baseline observability, security, and governance for this tier.";
      let opsNotes = "";
      let migrationMain = providerName + " migration & onboarding focus.";
      let migrationNotes = "Use native migration tooling and IaC-driven landing zones.";
      let securityMain = "Security and network posture aligned to this workload.";
      let securityNotes = "";
      let drPatternLabel = "";

      /* ===================== AZURE ===================== */
      if (cloud === "azure") {
        // Compute
        if (architectureType === "web-api" || architectureType === "") {
          if ((trafficPattern === "low" || trafficPattern === "medium") && hasSkill("paas")) {
            computeMain =
              "Use <strong>Azure App Service</strong> for the web/API layer, fronted by " +
              "<strong>Azure Application Gateway (WAF)</strong> and optionally <strong>Azure Front Door</strong>.";
            computeNotes =
              "App Service gives managed runtimes and autoscale. Application Gateway provides WAF and TLS offload; Front Door adds global routing.";
          } else if (trafficPattern === "spiky" && hasSkill("serverless")) {
            computeMain =
              "Use <strong>Azure Functions</strong> behind <strong>Azure API Management</strong>.";
            computeNotes =
              "Good for bursty traffic. Use Premium Functions to avoid cold starts. API Management handles auth, quotas, and versioning.";
          } else if (hasSkill("containers")) {
            computeMain =
              "Use <strong>Azure Kubernetes Service (AKS)</strong> or <strong>Azure Container Apps</strong> behind Application Gateway.";
            computeNotes =
              "Container Apps gives simpler PaaS experience; AKS is the full Kubernetes platform. Use node pools, autoscaling, and zones for HA.";
          } else {
            computeMain =
              "Use <strong>Azure Virtual Machines</strong> with <strong>Virtual Machine Scale Sets</strong> behind Application Gateway.";
            computeNotes =
              "Lift & shift baseline. Use availability zones, managed disks, and autoscale rules.";
          }
        } else if (architectureType === "microservices") {
          if (hasSkill("containers")) {
            computeMain =
              "Run microservices on <strong>AKS</strong> with <strong>Azure CNI</strong> networking, fronted by Application Gateway / Front Door.";
            computeNotes =
              "Use GitOps (Flux/Argo), Azure Policy, and Key Vault for config & secrets.";
          } else {
            computeMain =
              "Use <strong>Azure Container Apps</strong> with Dapr for microservices patterns.";
            computeNotes =
              "Container Apps abstracts Kubernetes; use revisions, autoscale, and Dapr building blocks for pub/sub, service discovery, etc.";
          }
        } else if (architectureType === "batch") {
          computeMain =
            "Use <strong>Azure Batch</strong> or <strong>Synapse/Fabric pipelines</strong> scheduled via <strong>Azure Data Factory</strong> or Logic Apps.";
          computeNotes =
            "Batch manages pools of compute VMs; Synapse/Fabric covers ELT/analytics-style jobs.";
        } else if (architectureType === "event-driven") {
          computeMain =
            "Use <strong>Azure Functions</strong> with <strong>Event Grid</strong> / <strong>Event Hubs</strong> triggers.";
          computeNotes =
            "Serverless consumers for events; Event Hubs for high-throughput streams, Event Grid for discrete events.";
        } else if (architectureType === "legacy-vm") {
          computeMain =
            "Lift & shift to <strong>Azure VMs / VM Scale Sets</strong>, or use <strong>Azure VMware Solution (AVS)</strong> if staying on VMware.";
          computeNotes =
            "For on-prem VMware with minimal change, AVS + HCX gives low-friction relocation; otherwise migrate VMs to native Azure with Azure Migrate.";
        } else if (architectureType === "data-analytics") {
          computeMain =
            "Use <strong>Azure Synapse Analytics</strong> or <strong>Microsoft Fabric</strong> with <strong>Azure Data Lake Storage Gen2</strong>.";
          computeNotes =
            "Data flows via Azure Data Factory / Synapse pipelines; consider serverless SQL pools, Spark pools, and Power BI.";
        }

        // Data
        if (dataType === "relational" || dataType === "") {
          dataMain =
            "Use <strong>Azure SQL Database</strong> or <strong>Azure SQL Managed Instance</strong> for core OLTP, with " +
            "<strong>Azure Database for PostgreSQL / MySQL</strong> as needed.";
          dataNotes =
            "Choose single/elastic pools vs managed instance based on compatibility and isolation. Always-on encryption, TDE, and private endpoints for regulated data.";
        } else if (dataType === "nosql") {
          dataMain =
            "Use <strong>Azure Cosmos DB</strong> (Core API, Mongo API, or Cassandra API) for low-latency, globally distributed data.";
          dataNotes =
            "Cosmos DB gives multi-region writes and global distribution. Combine with Azure Functions/Event Grid for reactive patterns.";
        } else if (dataType === "files") {
          dataMain =
            "Use <strong>Azure Blob Storage</strong> or <strong>Azure Data Lake Storage Gen2</strong>, plus <strong>Azure Files</strong> for SMB workloads.";
          dataNotes =
            "Enable private endpoints, lifecycle policies, and immutability (WORM) for regulated/financial data.";
        } else if (dataType === "streaming") {
          dataMain =
            "Use <strong>Azure Event Hubs</strong> or <strong>Azure IoT Hub</strong> for ingestion, landing into Data Lake Storage and/or Synapse.";
          dataNotes =
            "Process streams with Azure Stream Analytics or Synapse/Fabric streaming workloads.";
        } else if (dataType === "analytics-lake") {
          dataMain =
            "Use <strong>Data Lake Storage Gen2</strong> as the lake and <strong>Synapse / Fabric</strong> for lakehouse & analytics.";
          dataNotes =
            "Use Data Factory / Synapse pipelines for ingestion, Microsoft Purview for governance/catalog, and Power BI for BI.";
        }

        if (regulated) {
          dataNotes +=
            (dataNotes ? " " : "") +
            "For regulated workloads, prefer <strong>Azure Government</strong> or appropriately scoped commercial regions, " +
            "with Key Vault / Managed HSM, private endpoints, and Microsoft Purview classification.";
        }

        // Integration
        if (integrations === "simple-http" || integrations === "") {
          integMain =
            "Expose APIs via <strong>Azure API Management</strong> in front of App Service, Functions, or AKS/Container Apps.";
          integNotes =
            "Use JWT / OAuth, rate limiting, and policies. For internal-only APIs, combine with Application Gateway and private endpoints.";
        } else if (integrations === "enterprise-messaging") {
          integMain =
            "Use <strong>Azure Service Bus</strong> (queues/topics) for enterprise messaging.";
          integNotes =
            "Good for ordered, durable messaging between services; pair with Functions or Logic Apps for handlers.";
        } else if (integrations === "event-streaming") {
          integMain = "Use <strong>Event Hubs</strong> with <strong>Stream Analytics</strong> / Synapse.";
          integNotes =
            "Event Hubs for high-throughput event streams; Stream Analytics / Synapse for near-real-time processing.";
        } else if (integrations === "orchestration") {
          integMain =
            "Use <strong>Logic Apps</strong> and/or <strong>Durable Functions</strong> for orchestration of complex workflows.";
          integNotes =
            "Logic Apps offers connectors to SaaS; Durable Functions for stateful orchestration in code.";
        }

        // Ops / resilience
        opsMain =
          "Treat this as <strong>" + tierLabel + "</strong> on Azure and design HA/DR accordingly.";
        if (criticality === "tier0") {
          opsMain +=
            " Use multi-zone deployments and consider active-active or active-passive across paired regions.";
        } else if (criticality === "tier1") {
          opsMain +=
            " Use zone-redundant services and regular backup + DR tests, potentially with secondary region failover.";
        } else if (criticality === "tier2") {
          opsMain +=
            " Single-region with strong backups is often sufficient, but consider zones for key components.";
        }

        opsNotes =
          "Use <strong>Azure Monitor</strong>, <strong>Log Analytics</strong>, and <strong>Application Insights</strong> for observability; " +
          "<strong>Microsoft Sentinel</strong> for SIEM; <strong>Defender for Cloud</strong> and Azure Policy/Blueprints for security posture.";

        if (regulated) {
          opsNotes +=
            " For public sector IL workloads, deploy into <strong>Azure Government</strong> with ExpressRoute + VPN, Entra ID federation, and IL5/IL6-aligned logging to your central SIEM.";
        }

        migrationMain = "Azure migration & onboarding focus.";
        migrationNotes =
          "Use <strong>Azure Migrate</strong> to discover and assess on-prem estates. " +
          "For VMware-heavy environments and 'relocate/rehost' strategies, use <strong>Azure VMware Solution (AVS)</strong> with HCX. " +
          "Provision landing zones with IaC (Terraform or Bicep/ARM) and enforce guardrails via Management Groups and Policy.";

        if (usesIaC("terraform") || usesIaC("cloud-native")) {
          migrationNotes +=
            " Standardize on Terraform and/or Bicep templates for landing zones, VNets, NSGs, and PaaS services, integrating with Azure DevOps or GitHub Actions for CI/CD.";
        }
        if (usesIaC("ansible")) {
          migrationNotes +=
            " Use <strong>Ansible</strong> for OS configuration, middleware setup, and application deployments on Azure VMs / AVS.";
        }

        migrationNotes +=
          " For connectivity into CHEDC or central data centers, use <strong>ExpressRoute + VPN</strong>; send logs to your central SIEM per IL guidance.";
      }

      /* ===================== AWS ===================== */
      else if (cloud === "aws") {
        if (architectureType === "web-api" || architectureType === "") {
          if ((trafficPattern === "low" || trafficPattern === "medium") && hasSkill("serverless")) {
            computeMain =
              "Use <strong>AWS Lambda</strong> behind <strong>Amazon API Gateway</strong>.";
            computeNotes =
              "Great for spiky traffic and pay-per-use. Use provisioned concurrency for strict latency.";
          } else if (hasSkill("paas")) {
            computeMain = "Use <strong>AWS Elastic Beanstalk</strong> or <strong>AWS App Runner</strong>.";
            computeNotes =
              "Beanstalk / App Runner give managed application runtimes with autoscaling, fronted by <strong>Application Load Balancer (ALB)</strong>.";
          } else if (hasSkill("containers")) {
            computeMain =
              "Use <strong>Amazon ECS</strong> (Fargate) or <strong>Amazon EKS</strong> with ALB and AWS App Mesh if needed.";
            computeNotes =
              "Fargate reduces ops burden; EKS for full Kubernetes. Use target groups, autoscaling, and multi-AZ.";
          } else {
            computeMain =
              "Use <strong>Amazon EC2</strong> instances in Auto Scaling groups behind an Application Load Balancer.";
            computeNotes =
              "Baseline lift & shift pattern. Spread across multiple AZs for availability.";
          }
        } else if (architectureType === "microservices") {
          computeMain =
            "Run microservices on <strong>EKS</strong> or <strong>ECS on Fargate</strong> with a shared ALB/API Gateway front end.";
          computeNotes =
            "Use service discovery (Cloud Map), App Mesh (if needed), and GitOps/CI pipelines for deployments.";
        } else if (architectureType === "batch") {
          computeMain =
            "Use <strong>AWS Batch</strong> or <strong>Step Functions + Lambda/ECS</strong> for scheduled jobs.";
          computeNotes =
            "Batch orchestrates jobs over EC2/Fargate. Step Functions for complex stateful workflows.";
        } else if (architectureType === "event-driven") {
          computeMain =
            "Use <strong>Lambda</strong> with <strong>Amazon EventBridge</strong>, <strong>SQS</strong>, and <strong>SNS</strong>.";
          computeNotes =
            "EventBridge for event bus, SQS for queues, SNS for fan-out notifications.";
        } else if (architectureType === "legacy-vm") {
          computeMain =
            "Lift & shift with <strong>AWS Application Migration Service (MGN)</strong> to EC2, or use <strong>VMware Cloud on AWS</strong> for minimal change.";
          computeNotes =
            "MGN for rehost; VMware Cloud on AWS for relocate. Combine with AWS Systems Manager for patching.";
        } else if (architectureType === "data-analytics") {
          computeMain =
            "Use <strong>Amazon Redshift</strong> or <strong>Athena + Glue Data Catalog</strong> over data in <strong>Amazon S3</strong>.";
          computeNotes =
            "Glue ETL/ELT, EMR or Glue for Spark jobs, QuickSight for BI.";
        }

        if (dataType === "relational" || dataType === "") {
          dataMain =
            "Use <strong>Amazon RDS</strong> (PostgreSQL/MySQL/SQL Server/Oracle) or <strong>Amazon Aurora</strong> for OLTP.";
          dataNotes =
            "Multi-AZ for HA, read replicas for scale. Use KMS for encryption and Secrets Manager for creds.";
        } else if (dataType === "nosql") {
          dataMain =
            "Use <strong>Amazon DynamoDB</strong> or <strong>Amazon DocumentDB</strong> for NoSQL workloads.";
          dataNotes =
            "DynamoDB for key-value / document with global tables; DocumentDB for Mongo-compatible workloads.";
        } else if (dataType === "files") {
          dataMain =
            "Use <strong>Amazon S3</strong> for object storage, <strong>Amazon EFS</strong> for shared POSIX, and <strong>Amazon FSx</strong> (NetApp/Windows) when needed.";
          dataNotes =
            "Use S3 bucket policies, encryption, and lifecycle management; Glacier for archives.";
        } else if (dataType === "streaming") {
          dataMain =
            "Use <strong>Amazon Kinesis</strong> or <strong>Amazon MSK (Managed Kafka)</strong> for streaming data.";
          dataNotes =
            "Kinesis Data Streams + Firehose into S3/Redshift; MSK for Kafka-based ecosystems.";
        } else if (dataType === "analytics-lake") {
          dataMain =
            "Use <strong>Amazon S3</strong> as the data lake with <strong>Athena</strong>, <strong>Redshift</strong>, and <strong>Glue</strong>.";
          dataNotes =
            "Glue Data Catalog for metadata, Lake Formation for governance, QuickSight for BI.";
        }

        if (regulated) {
          dataNotes +=
            (dataNotes ? " " : "") +
            "For financial or IL workloads, prefer <strong>AWS GovCloud (US)</strong> or appropriately scoped regions; " +
            "enforce encryption, VPC endpoints, and IAM least privilege.";
        }

        if (integrations === "simple-http" || integrations === "") {
          integMain =
            "Expose APIs via <strong>Amazon API Gateway</strong> or <strong>AWS Application Load Balancer</strong> (HTTP).";
          integNotes =
            "API Gateway for rich API management; ALB for simpler L7 routing direct to services.";
        } else if (integrations === "enterprise-messaging") {
          integMain =
            "Use <strong>SQS</strong> (queues) and <strong>SNS</strong> (pub/sub) as the core messaging layer.";
          integNotes =
            "Durable, decoupled messaging patterns between services and workloads.";
        } else if (integrations === "event-streaming") {
          integMain =
            "Use <strong>Amazon EventBridge</strong> and/or <strong>Kinesis</strong> / <strong>MSK</strong>.";
          integNotes =
            "EventBridge for SaaS and AWS service events; Kinesis/MSK for higher-volume event streams.";
        } else if (integrations === "orchestration") {
          integMain =
            "Use <strong>AWS Step Functions</strong> to orchestrate complex workflows across Lambda, ECS, and other AWS services.";
          integNotes =
            "Visual, state-machine-based orchestration with retries, error handling, and parallelism.";
        }

        opsMain =
          "Treat this as <strong>" + tierLabel + "</strong> on AWS and design HA/DR across AZs (and regions if needed).";
        if (criticality === "tier0") {
          opsMain +=
            " Use multi-AZ + possibly multi-region with Route 53 and global services.";
        } else if (criticality === "tier1") {
          opsMain +=
            " Use multi-AZ for core services with regular DR tests and backups.";
        } else if (criticality === "tier2") {
          opsMain +=
            " Single region with backups may be enough; still consider multi-AZ for stateless tiers.";
        }

        opsNotes =
          "Use <strong>Amazon CloudWatch</strong> for metrics/logs, <strong>AWS X-Ray</strong> for tracing, " +
          "<strong>AWS Config</strong> and <strong>CloudTrail</strong> for governance/audit, and <strong>AWS Security Hub</strong> / <strong>GuardDuty</strong> for security posture.";

        if (regulated) {
          opsNotes +=
            " Connect via <strong>AWS Direct Connect + VPN</strong> into CHEDC or central networks; send logs to IL5/IL6 SIEM per your policy.";
        }

        migrationMain = "AWS migration & onboarding focus.";
        migrationNotes =
          "Use <strong>AWS Migration Hub</strong> and <strong>AWS Application Migration Service (MGN)</strong> for discovery and rehost; " +
          "<strong>AWS Database Migration Service (DMS)</strong> for database moves. " +
          "For 'relocate' VMware workloads, use <strong>VMware Cloud on AWS</strong>.";

        if (usesIaC("terraform") || usesIaC("cloud-native")) {
          migrationNotes +=
            " Provision landing zones and guardrails with <strong>Terraform</strong> and/or <strong>CloudFormation</strong>, " +
            "using Control Tower and Organizations for multi-account structures.";
        }
        if (usesIaC("ansible")) {
          migrationNotes +=
            " Use <strong>Ansible</strong> for OS/middleware configuration, integrated with SSM Session Manager & Run Command.";
        }

        migrationNotes +=
          " For DevSecOps, use <strong>CodePipeline</strong> + <strong>CodeBuild</strong> or your preferred CI/CD, pushing logs into CloudWatch and your central SIEM.";
      }

      /* ===================== GCP ===================== */
      else if (cloud === "gcp") {
        if (architectureType === "web-api" || architectureType === "") {
          if (hasSkill("serverless")) {
            computeMain =
              "Use <strong>Cloud Run</strong> or <strong>Cloud Functions</strong> behind <strong>API Gateway</strong> or <strong>External HTTP(S) Load Balancing</strong>.";
            computeNotes =
              "Cloud Run (containers) and Cloud Functions (functions) both scale to zero; Cloud Run often best for web APIs.";
          } else if (hasSkill("containers")) {
            computeMain =
              "Use <strong>Google Kubernetes Engine (GKE)</strong> behind global HTTP(S) Load Balancing.";
            computeNotes =
              "Use regional clusters with multiple zones; autopilot mode for reduced ops overhead.";
          } else {
            computeMain =
              "Use <strong>Compute Engine</strong> managed instance groups behind HTTP(S) load balancers.";
            computeNotes =
              "Lift & shift baseline with autoscaling and multi-zone deployments.";
          }
        } else if (architectureType === "microservices") {
          computeMain =
            "Run microservices on <strong>GKE</strong> or <strong>Cloud Run</strong> with service-to-service auth via IAM and mTLS.";
          computeNotes =
            "Use Anthos/GKE for hybrid environments if needed; integrate with Config Sync / GitOps.";
        } else if (architectureType === "batch") {
          computeMain =
            "Use <strong>Cloud Run jobs</strong>, <strong>Cloud Functions</strong>, or <strong>Compute Engine with Cloud Scheduler</strong>.";
          computeNotes =
            "For heavy data workloads, combine with Dataflow or Dataproc.";
        } else if (architectureType === "event-driven") {
          computeMain =
            "Use <strong>Cloud Functions</strong> or <strong>Cloud Run</strong> triggered by <strong>Pub/Sub</strong> and <strong>Eventarc</strong>.";
          computeNotes =
            "Pub/Sub + Eventarc capture events from GCP services and custom apps.";
        } else if (architectureType === "legacy-vm") {
          computeMain =
            "Lift & shift to <strong>Compute Engine</strong> (managed instance groups) or use <strong>Google Cloud VMware Engine</strong> for VMware relocation.";
          computeNotes =
            "Combine with Migrate to Virtual Machines or Cloud VMware Engine HCX for minimal-change moves.";
        } else if (architectureType === "data-analytics") {
          computeMain =
            "Use <strong>BigQuery</strong> over data in <strong>Cloud Storage</strong> with <strong>Dataproc</strong> / <strong>Dataflow</strong> for processing.";
          computeNotes =
            "This is the standard lakehouse pattern on GCP.";
        }

        if (dataType === "relational" || dataType === "") {
          dataMain =
            "Use <strong>Cloud SQL</strong> (PostgreSQL/MySQL/SQL Server) or <strong>Cloud Spanner</strong> when you need global consistency and horizontal scale.";
          dataNotes =
            "Private Service Connect for private access, CMEK for encryption, backups and read replicas for HA.";
        } else if (dataType === "nosql") {
          dataMain =
            "Use <strong>Cloud Firestore</strong> or <strong>Cloud Bigtable</strong> depending on your access pattern.";
          dataNotes =
            "Firestore for document-style; Bigtable for high-throughput time-series or wide-column workloads.";
        } else if (dataType === "files") {
          dataMain =
            "Use <strong>Cloud Storage</strong> buckets for objects; <strong>Filestore</strong> for NFS where needed.";
          dataNotes =
            "Use bucket IAM, VPC Service Controls, and Object Lifecycle policies.";
        } else if (dataType === "streaming") {
          dataMain =
            "Use <strong>Pub/Sub</strong> with <strong>Dataflow</strong> for streaming pipelines.";
          dataNotes =
            "Pub/Sub provides durable queues; Dataflow handles transformations, windowing, and loading into BigQuery / Cloud Storage.";
        } else if (dataType === "analytics-lake") {
          dataMain =
            "Use <strong>Cloud Storage</strong> as the lake and <strong>BigQuery</strong> as the analytics engine.";
          dataNotes =
            "Use Dataplex/Data Catalog for governance, Looker for BI, and Dataflow/Dataproc for ETL.";
        }

        if (regulated) {
          dataNotes +=
            (dataNotes ? " " : "") +
            "For public sector or high-sensitivity workloads, use <strong>Assured Workloads</strong> / regulated regions, VPC Service Controls, and CMEK everywhere.";
        }

        if (integrations === "simple-http" || integrations === "") {
          integMain =
            "Expose APIs via <strong>API Gateway</strong> or <strong>Cloud Endpoints</strong>.";
          integNotes =
            "Front door for Cloud Run, GKE, or Functions with auth, quota, and monitoring.";
        } else if (integrations === "enterprise-messaging") {
          integMain =
            "Use <strong>Pub/Sub</strong> as the main asynchronous messaging layer.";
          integNotes =
            "Use multiple subscriptions for fan-out; pair with Functions/Cloud Run and Dataflow.";
        } else if (integrations === "event-streaming") {
          integMain =
            "Use <strong>Pub/Sub</strong> with <strong>Dataflow</strong> or <strong>Eventarc</strong>.";
          integNotes =
            "Pub/Sub for events; Dataflow/Dataproc for processing; Eventarc for routing events from Google services.";
        } else if (integrations === "orchestration") {
          integMain =
            "Use <strong>Workflows</strong> for service orchestration and <strong>Cloud Composer</strong> (Airflow) for data pipelines.";
          integNotes =
            "Workflows for API/service compositions; Composer for DAG-based ETL.";
        }

        opsMain =
          "Treat this as <strong>" + tierLabel + "</strong> on Google Cloud and design HA/DR accordingly.";
        if (criticality === "tier0") {
          opsMain +=
            " Use multi-zonal and potentially multi-regional deployments with global HTTP(S) load balancing.";
        } else if (criticality === "tier1") {
          opsMain +=
            " Use regional multi-zonal deployments with tested backup/restore and failover.";
        } else if (criticality === "tier2") {
          opsMain +=
            " Single-region is often fine, but maintain backups and DR runbooks.";
        }

        opsNotes =
          "Use <strong>Cloud Monitoring</strong> and <strong>Cloud Logging</strong> for observability; " +
          "<strong>Error Reporting</strong>, <strong>Cloud Trace</strong>, and <strong>Profiler</strong> for diagnostics; " +
          "<strong>Security Command Center</strong> for security posture and threat detection.";

        if (regulated) {
          opsNotes +=
            " For IL and public sector workloads, ensure appropriate organizational policies, VPC Service Controls, and restricted regions.";
        }

        migrationMain = "GCP migration & onboarding focus.";
        migrationNotes =
          "Use <strong>Migrate to Virtual Machines</strong> or <strong>Google Cloud VMware Engine</strong> for VMware estates; " +
          "<strong>Database Migration Service</strong> for relational moves; <strong>Transfer Appliance</strong> / Storage Transfer Service for large data sets.";

        if (usesIaC("terraform") || usesIaC("cloud-native")) {
          migrationNotes +=
            " Provision landing zones, VPCs, firewall rules, and projects with <strong>Terraform</strong> and/or <strong>Deployment Manager</strong>, integrated into Cloud Build / your CI/CD.";
        }
        if (usesIaC("ansible")) {
          migrationNotes +=
            " Use <strong>Ansible</strong> to configure Compute Engine instances and on-prem nodes during hybrid migrations.";
        }

        migrationNotes +=
          " For connectivity, use <strong>Cloud Interconnect + VPN</strong> into CHEDC or central sites; federate identities via IAP + Context-Aware Access.";
      }

      /* ===================== OCI ===================== */
      else if (cloud === "oci") {
        if (architectureType === "web-api" || architectureType === "") {
          if (hasSkill("serverless")) {
            computeMain =
              "Use <strong>Oracle Functions</strong> (Fn) behind <strong>OCI API Gateway</strong>.";
            computeNotes =
              "Good for bursty HTTP APIs; integrate with Object Storage, Streaming, and DB services.";
          } else if (hasSkill("containers")) {
            computeMain =
              "Use <strong>Oracle Container Engine for Kubernetes (OKE)</strong> behind Load Balancers.";
            computeNotes =
              "OKE is the managed Kubernetes service; use node pools, autoscaling, and NSGs for isolation.";
          } else {
            computeMain =
              "Use <strong>OCI Compute instances</strong> with autoscaling and <strong>OCI Load Balancing</strong>.";
            computeNotes =
              "Baseline for VM-centric workloads; spread across fault domains and ADs.";
          }
        } else if (architectureType === "microservices") {
          computeMain =
            "Run microservices on <strong>OKE</strong>, combined with API Gateway and Service Mesh (where available) for east-west traffic.";
          computeNotes =
            "Use Helm/Argo/etc. for deployments and observability via OCI Monitoring + Logging.";
        } else if (architectureType === "batch") {
          computeMain =
            "Use <strong>OCI Container Engine</strong> or Compute with <strong>Resource Manager</strong>-provisioned clusters and scheduled jobs.";
          computeNotes =
            "Combine with Events + Functions for triggers.";
        } else if (architectureType === "event-driven") {
          computeMain =
            "Use <strong>Oracle Functions</strong> and <strong>OCI Streaming</strong> triggered by Events.";
          computeNotes =
            "Events + Streaming + Functions pattern for asynchronous processing.";
        } else if (architectureType === "legacy-vm") {
          computeMain =
            "Lift & shift to <strong>OCI Compute</strong> or use <strong>Oracle Cloud VMware Solution (OCVS)</strong> for VMware relocation.";
          computeNotes =
            "OCVS gives dedicated VMware SDDCs on OCI for minimal-change migrations.";
        } else if (architectureType === "data-analytics") {
          computeMain =
            "Use <strong>Oracle Autonomous Data Warehouse</strong> and <strong>Object Storage</strong> for lakehouse-style analytics.";
          computeNotes =
            "GoldenGate for replication, Data Integration / Data Flow (Spark) for pipelines, and Oracle Analytics for BI.";
        }

        if (dataType === "relational" || dataType === "") {
          dataMain =
            "Use <strong>Oracle Autonomous Transaction Processing (ATP)</strong> or <strong>Autonomous Database</strong>, and/or <strong>Oracle Database Cloud Service</strong>.";
          dataNotes =
            "Autonomous DB handles patching and tuning; use Data Guard for HA/DR and Transparent Data Encryption.";
        } else if (dataType === "nosql") {
          dataMain =
            "Use <strong>Oracle NoSQL Database Cloud Service</strong> or <strong>Autonomous JSON Database</strong>.";
          dataNotes =
            "Appropriate for key-value/document workloads needing Oracle integration.";
        } else if (dataType === "files") {
          dataMain =
            "Use <strong>OCI Object Storage</strong> and <strong>File Storage Service</strong> for POSIX-style workloads.";
          dataNotes =
            "Enable encryption, replication, and lifecycle policies for financial/regulated data.";
        } else if (dataType === "streaming") {
          dataMain =
            "Use <strong>OCI Streaming</strong> service for Kafka-like streaming.";
          dataNotes =
            "Combine with Functions, Data Flow, or external consumers for processing.";
        } else if (dataType === "analytics-lake") {
          dataMain =
            "Use <strong>Object Storage</strong> as the lake and <strong>Autonomous Data Warehouse</strong> / <strong>Big Data Service</strong> for analytics.";
          dataNotes =
            "Use Data Catalog and Data Integration to govern and ingest.";
        }

        if (regulated) {
          dataNotes +=
            (dataNotes ? " " : "") +
            "For national security or IL-equivalent workloads, use <strong>Oracle National Security Regions (NSR)</strong> or appropriate government regions, with Cloud Guard and Vault.";
        }

        if (integrations === "simple-http" || integrations === "") {
          integMain =
            "Expose APIs via <strong>OCI API Gateway</strong> in front of Functions, OKE, or Compute.";
          integNotes =
            "Use JWT/identity integration with IDCS and WAF policies.";
        } else if (integrations === "enterprise-messaging") {
          integMain =
            "Use <strong>OCI Streaming</strong> plus <strong>OCI Queue</strong> (where available) and <strong>Integration Cloud (OIC)</strong> for SaaS/ERP integration.";
          integNotes =
            "Useful for complex integrations across Oracle SaaS, on-prem, and third-party systems.";
        } else if (integrations === "event-streaming") {
          integMain =
            "Use <strong>OCI Streaming</strong> with Functions or Data Flow for event processing.";
          integNotes =
            "Pattern similar to Kafka + serverless / Spark processing.";
        } else if (integrations === "orchestration") {
          integMain =
            "Use <strong>Oracle Integration Cloud (OIC)</strong> for rich workflow/orchestration and SaaS integration patterns.";
          integNotes =
            "Good for ERP/HCM/financial package integration flows.";
        }

        opsMain =
          "Treat this as <strong>" + tierLabel + "</strong> on OCI and design HA/DR with fault domains, availability domains, and regions.";
        if (criticality === "tier0") {
          opsMain +=
            " Use multi-AD or region-to-region replication for critical systems.";
        } else if (criticality === "tier1") {
          opsMain +=
            " Use multiple fault domains and Data Guard / backups for key databases.";
        } else if (criticality === "tier2") {
          opsMain +=
            " Single region is often acceptable with robust backup and DR runbooks.";
        }

        opsNotes =
          "Use <strong>OCI Monitoring</strong>, <strong>Logging</strong>, and <strong>Events</strong> for observability; " +
          "<strong>Cloud Guard</strong> for posture management; <strong>Security Zones</strong> and IAM policies/dynamic groups for controls.";

        if (regulated) {
          opsNotes +=
            " For IL-equivalent workloads, use NSR/government regions, FastConnect + VPN to CHEDC, and log forwarding into centralized SIEM.";
        }

        migrationMain = "OCI migration & onboarding focus.";
        migrationNotes =
          "For VMware-heavy estates, use <strong>Oracle Cloud VMware Solution (OCVS)</strong> as a relocation target. " +
          "Use <strong>OCI Database Migration</strong> and Data Pump/GoldenGate for DB moves; " +
          "<strong>Data Transfer Service</strong> / FastConnect for large data sets.";

        if (usesIaC("terraform") || usesIaC("cloud-native")) {
          migrationNotes +=
            " Use <strong>Terraform</strong> (with OCI provider) or <strong>OCI Resource Manager</strong> to define landing zones, VCNs, security lists, and services as code.";
        }
        if (usesIaC("ansible")) {
          migrationNotes +=
            " Use <strong>Ansible</strong> for guest OS and middleware configuration on OCI Compute and OCVS.";
        }

        migrationNotes +=
          " Connect into CHEDC or central networks with <strong>FastConnect + VPN</strong>; integrate IDCS SAML federation and OCI DevOps Pipelines for CI/CD.";
      }

      // Generic initiative-type adjustments
      if (initiativeType === "new-service") {
        migrationNotes +=
          " Because this is a <strong>new service</strong>, emphasize greenfield landing zones, DevSecOps pipelines, and fast iteration, " +
          "with clear guardrails so future migrations can reuse this pattern.";
      } else if (initiativeType === "existing-service") {
        migrationNotes +=
          " Because this is a change to an <strong>existing service</strong>, run side-by-side testing, performance baselines, and audit of legacy controls " +
          "so you can show improvement against current issues.";
      } else if (initiativeType === "maintenance") {
        opsNotes +=
          " Because this is a <strong>maintenance / operations</strong> initiative, focus heavily on patch automation, SLO dashboards, incident reduction, and FinOps (cost reporting & cleanup).";
      } else if (initiativeType === "migration") {
        migrationNotes +=
          " Because this is a <strong>migration</strong> initiative, design waves, cutover rehearsals, and rollback plans around your chosen cutover strategy.";
        if (migrationScope) {
          migrationNotes += " Scope: <em>" + migrationScope + "</em>.";
        }
        if (cutoverStrategy) {
          migrationNotes += " Cutover strategy: <em>" + cutoverStrategy + "</em>.";
        }
      }

      
      // Security & network controls (deck-ready wording)
      const baselineLabel =
        securityBaseline === "stig"
          ? "DoD/STIG-aligned hardening"
          : securityBaseline === "regulated"
          ? "strict regulated baseline (PCI/PHI/SOX-like)"
          : securityBaseline === "standard"
          ? "standard enterprise baseline (CIS / internal security baseline)"
          : securityBaseline === "minimal"
          ? "minimal baseline (best-effort hardening only)"
          : null;

      const perimeterHint =
        perimeterPattern === "cloud-plus-f5"
          ? "Use cloud-native firewalls for north–south and east–west segmentation, and layer <strong>F5 services</strong> at the edge for advanced WAAP, bot, and API protection."
          : perimeterPattern === "f5-centric"
          ? "Position <strong>F5 (BIG-IP / NGINX / Distributed Cloud)</strong> as the primary perimeter and WAAP tier, complemented by cloud-native network security groups and firewalls."
          : perimeterPattern === "legacy-fw"
          ? "Retain the existing on-prem firewall in the near term, but plan to move toward cloud-native firewalls and/or F5 services to reduce hairpin/backhaul and improve agility."
          : "Lead with cloud-native firewalls, WAF, and private endpoints as the default perimeter and segmentation controls.";

      const identityHint =
        identityModel === "cloud-iam-only"
          ? "Standardize on cloud-native IAM roles and groups, avoid long-lived keys, and minimize local accounts."
          : identityModel === "hybrid-ad-entra"
          ? "Treat AD / Entra as a Tier 0 dependency; harden sync paths, use privileged access workstations, and prefer group-based RBAC for cloud resources."
          : identityModel === "external-idp-plus-iam"
          ? "Use the external IdP for SSO and workforce auth, and cloud IAM roles for workload access; keep privilege boundaries clear between the two."
          : null;

      const secretsHint =
        secretsModel === "basic"
          ? "Move application secrets out of code/config and into a managed secrets store with rotation policies."
          : secretsModel === "secrets-manager"
          ? "Standardize on a cloud-native secrets manager for all app credentials, API keys, and connection strings."
          : secretsModel === "hsm-backed"
          ? "Use HSM-backed keys for critical and regulated workloads, with strong separation of duties for key administration."
          : null;

      const dataProtectionHint =
        dataProtection === "at-rest"
          ? "Ensure encryption-at-rest for all managed data services and disks, and document who owns the keys."
          : dataProtection === "in-transit-and-at-rest"
          ? "Enforce TLS for all traffic (internal and external), align on modern cipher policies, and ensure encryption-at-rest everywhere."
          : dataProtection === "field-level"
          ? "Introduce tokenization, field-level encryption, and/or anonymization for sensitive fields, with isolated key management for those datasets."
          : null;

      securityMain =
        "Apply " +
        (baselineLabel || "an appropriate security baseline") +
        " with opinionated identity, secrets management, network segmentation, and perimeter controls for this workload.";

      securityNotes = perimeterHint;

      if (identityHint) {
        securityNotes += (securityNotes ? " " : "") + identityHint;
      }
      if (secretsHint) {
        securityNotes += (securityNotes ? " " : "") + secretsHint;
      }
      if (dataProtectionHint) {
        securityNotes += (securityNotes ? " " : "") + dataProtectionHint;
      }

      if (Array.isArray(f5Usage) && f5Usage.length) {
        const f5Parts = [];

        if (f5Usage.indexOf("waap-web") !== -1) {
          f5Parts.push("Use F5 WAAP/WAF (BIG-IP Advanced WAF, NGINX App Protect, or Distributed Cloud WAAP) in front of public web and portal endpoints.");
        }
        if (f5Usage.indexOf("api-security") !== -1) {
          f5Parts.push("Standardize on F5 for API gateway and API security for critical APIs – for example Distributed Cloud API Security or an NGINX-based gateway.");
        }
        if (f5Usage.indexOf("ddos") !== -1) {
          f5Parts.push("Use F5 DDoS protections (on-prem BIG-IP or Distributed Cloud DDoS) for internet-facing Tier 0/1 properties.");
        }
        if (f5Usage.indexOf("gslb") !== -1) {
          f5Parts.push("Use F5 DNS / GSLB to steer traffic across regions and improve availability and latency.");
        }
        if (f5Usage.indexOf("service-mesh") !== -1) {
          f5Parts.push("Consider F5 for service-mesh-style L7 control in front of microservices and Kubernetes workloads.");
        }
        if (f5Usage.indexOf("remote-access") !== -1) {
          f5Parts.push("Use F5 for secure remote access / ZTNA as you transition away from legacy VPN patterns.");
        }

        if (f5Parts.length) {
          securityNotes += (securityNotes ? " " : "") + f5Parts.join(" ");
        }
      }

      if (secOpsMaturity === "basic") {
        securityNotes +=
          (securityNotes ? " " : "") +
          "Turn on platform logs and WAF/F5 telemetry, ship them to at least one central log store, and define a minimal alert set and owners.";
      } else if (secOpsMaturity === "central-siem") {
        securityNotes +=
          (securityNotes ? " " : "") +
          "Integrate cloud, application, and F5 telemetry into a central SIEM/SOC with clear runbooks for high-severity alerts.";
      } else if (secOpsMaturity === "mature-devsecops") {
        securityNotes +=
          (securityNotes ? " " : "") +
          "Embed security into CI/CD with SAST/DAST, policy-as-code, and automated deployment of firewall/WAF/F5 policies (AS3/DO/XC APIs).";
      }

      if (regulated) {
        securityNotes +=
          (securityNotes ? " " : "") +
          "Enforce private endpoints or service endpoints, customer-managed keys, and strict change control for security configuration.";
      }

      if (isPublicSector) {
        securityNotes +=
          (securityNotes ? " " : "") +
          "For public-sector impact levels (L2/L4/L5/L6), align to the relevant control framework and prefer government/sovereign regions where required.";
      }

      if (criticality === "tier0") {
        securityNotes +=
          (securityNotes ? " " : "") +
          "For Tier 0 workloads, design for zero-trust access, strong MFA, and defense-in-depth at identity, network, and application layers.";
      }

      // DR pattern label for deck summaries
      const tightRto = rto === "mins" || rto === "hour";
      const tightRpo = rpo === "zero" || rpo === "15min";
      const multiRegion =
        geoPattern === "multi-region" ||
        regionCount === "2" ||
        regionCount === "2-active" ||
        regionCount === "3plus";

      if (multiRegion && tightRto && tightRpo) {
        drPatternLabel = "Active–active multi-region with aggressive RTO/RPO.";
      } else if (multiRegion && (tightRto || tightRpo)) {
        drPatternLabel = "Warm standby or active–passive multi-region.";
      } else if (!multiRegion && (criticality === "tier0" || criticality === "tier1")) {
        drPatternLabel = "Multi-AZ in a single region; consider adding a DR region.";
      } else {
        drPatternLabel = "Backup-and-restore–centric DR pattern with relaxed RTO/RPO.";
      }

      if (drPatternLabel && opsNotes.indexOf("DR pattern:") === -1) {
        opsNotes += (opsNotes ? " " : "") + "DR pattern: " + drPatternLabel;
      }

return {
        computeMain,
        computeNotes,
        dataMain,
        dataNotes,
        integMain,
        integNotes,
        opsMain,
        opsNotes,
        migrationMain,
        migrationNotes,
        securityMain,
        securityNotes
      };
    }

    function buildHowToPlaybook(cloud, state) {
      const {
        initiativeType,
        newServiceType,
        existingChangeType,
        maintenanceFocus,
        migrationScope,
        workloadName,
        architectureType,
        dataSensitivity,
        criticality,
        sourceEnv,
        migrationApproach,
        iaCTools
      } = state;

      const workloadLabel = workloadName || "this workload";
      const isPublicSector =
        dataSensitivity === "ps-l2" ||
        dataSensitivity === "ps-l4" ||
        dataSensitivity === "ps-l5" ||
        dataSensitivity === "ps-l6";

      const isPrivateSectorLabel =
        dataSensitivity === "public" ||
        dataSensitivity === "internal" ||
        dataSensitivity === "confidential" ||
        dataSensitivity === "regulated";

      const sectorLabel =
        isPublicSector
          ? "public sector / impact-level workload"
          : dataSensitivity === "regulated"
          ? "regulated private-sector (financial/PHI) workload"
          : isPrivateSectorLabel
          ? "commercial private-sector workload"
          : "general commercial workload";

      const cloudLabel =
        cloud === "azure" ? "Azure"
        : cloud === "aws" ? "AWS"
        : cloud === "gcp" ? "Google Cloud"
        : "Oracle Cloud Infrastructure";

      const iaCLabel = iaCTools.length > 0
        ? iaCTools.join(", ")
        : "Terraform + cloud-native templates";

      const initLabelMap = {
        "new-service": "new service",
        "existing-service": "change to an existing service",
        "maintenance": "maintenance / operations initiative",
        "migration": "migration initiative"
      };
      const initiativeLabel = initLabelMap[initiativeType] || "cloud initiative";

      let initiativeDetail = "";
      if (initiativeType === "new-service" && newServiceType) {
        const nsMap = {
          "customer-facing": "customer-facing product",
          "internal-lob": "internal line-of-business system",
          "data-analytics-platform": "data / analytics platform",
          "integration-hub": "integration / API hub",
          "shared-platform": "shared platform capability"
        };
        initiativeDetail = nsMap[newServiceType] || newServiceType;
      } else if (initiativeType === "existing-service" && existingChangeType) {
        const ecMap = {
          "scale-ha": "scale & resilience",
          "features": "new feature delivery",
          "compliance": "compliance & security hardening",
          "cost": "cost optimization",
          "modernization": "modernization / tech-refresh"
        };
        initiativeDetail = ecMap[existingChangeType] || existingChangeType;
      } else if (initiativeType === "maintenance" && maintenanceFocus) {
        const mfMap = {
          "patching": "patching & updates",
          "performance": "performance tuning & capacity",
          "incident-reduction": "incident reduction / reliability",
          "cost": "cost optimization & housekeeping",
          "slo-reporting": "SLOs, reporting & governance"
        };
        initiativeDetail = mfMap[maintenanceFocus] || maintenanceFocus;
      } else if (initiativeType === "migration" && migrationScope) {
        const msMap = {
          "single-app": "single-application migration",
          "portfolio": "portfolio migration",
          "dc-estate": "data center / infrastructure estate migration",
          "db-only": "database / data-only migration"
        };
        initiativeDetail = msMap[migrationScope] || migrationScope;
      }

      const sourcePrettyMap = {
        "onprem-vmware": "on-prem VMware estate",
        "onprem-baremetal": "on-prem bare metal / mixed hypervisors",
        "existing-dc": "hosted / co-lo data center",
        "existing-cloud": "existing cloud environment",
        "saas": "SaaS-centric landscape",
        "hybrid": "hybrid on-prem + cloud environment"
      };
      let sourceLabel;
      if (sourceEnv) {
        sourceLabel = sourcePrettyMap[sourceEnv] || sourceEnv;
      } else if (initiativeType === "new-service") {
        sourceLabel = "no existing environment (greenfield)";
      } else {
        sourceLabel = "mixed on-prem / legacy environment";
      }

      const approachPrettyMap = {
        "rehost": "rehost (lift & shift)",
        "replatform": "replatform (minor cloud optimization)",
        "refactor": "refactor / modernize",
        "repurchase": "repurchase (SaaS)",
        "retain": "retain (stay where it is)",
        "retire": "retire (decommission)",
        "relocate": "relocate (VMware-as-a-Service)"
      };
      const approachLabel = migrationApproach
        ? approachPrettyMap[migrationApproach] || migrationApproach
        : "mix of rehost, replatform, and refactor where appropriate";

      return `
        <ol class="howto-list">
          <li>
            <strong>Phase 1 – Intake & discovery.</strong><br>
            Run a kickoff with business, security, and operations. Capture mission and business outcomes for this <em>${initiativeLabel}</em>
            for <em>${workloadLabel}</em>${initiativeDetail ? " focused on <em>" + initiativeDetail + "</em>" : ""}.
            Classify it as a ${sectorLabel}, and document the current hosting situation (${sourceLabel}), including dependencies,
            data flows, and any existing ATO / audit findings.
          </li>
          <li>
            <strong>Phase 2 – Requirements & readiness.</strong><br>
            Define non-functional targets (SLOs/RTO/RPO for the chosen tier ${criticality || "(set tier)"}), compliance scope
            (GLBA, PCI, SOX, NIST 800-53, FedRAMP / DoD SRG, FFIEC as applicable), data residency, and identity/SSO requirements.
            Decide the primary migration or change approach (${approachLabel}) per component and confirm which parts will be retained or retired.
          </li>
          <li>
            <strong>Phase 3 – Landing zone & architecture on ${cloudLabel}.</strong><br>
            Design a secure landing zone: management hierarchy (accounts/subscriptions/projects/tenancies),
            network topology (hub–spoke or mesh), connectivity into CHEDC / enterprise core
            (ExpressRoute / Direct Connect / Interconnect / FastConnect + VPN),
            and baseline guardrails (policies, configuration rules, encryption standards).
            Produce a reference architecture for <em>${workloadLabel}</em> (compute pattern, data services, integration and observability)
            using your cross-cloud service catalog and impact-level rules.
          </li>
          <li>
            <strong>Phase 4 – IaC, automation, and pipelines.</strong><br>
            Implement the landing zone, guardrails, and core shared services using <strong>${iaCLabel}</strong>.
            Stand up CI/CD pipelines (Azure DevOps / GitHub Actions / CodePipeline / Cloud Build / OCI DevOps) for both
            infrastructure and application code. Integrate secret management, image scanning, policy-as-code, and test gates into the pipelines
            so every change to ${workloadLabel} is repeatable and auditable.
          </li>
          <li>
            <strong>Phase 5 – Migration / change planning & wave design.</strong><br>
            ${
              initiativeType === "migration"
                ? "Group systems into migration waves (pilot → early adopters → bulk waves) according to dependency and risk. "
                : "Group work into waves (pilot → early adopters → broader rollout) so you can de-risk changes before full scale. "
            }
            For VMware-heavy estates, plan which systems use native ${cloudLabel} services vs the cloud’s VMware offering.
            Define cutover strategy per wave (blue/green, canary, phased, or big-bang), rollback plans, and detailed runbooks
            for both technical tasks and communications.
          </li>
          <li>
            <strong>Phase 6 – Security, RMF/ATO & controls.</strong><br>
            Map controls to ${cloudLabel} services: identity, network segmentation, key management, logging, vulnerability management,
            and endpoint protection. For IL and financial workloads, inherit CSP controls where allowed and add overlays for gaps.
            Build your control implementation statements, diagrams, test plans, and evidence collection up front, so ATO / audit
            runs in parallel with build and migration rather than after the fact.
          </li>
          <li>
            <strong>Phase 7 – Implementation, rollout & cutover.</strong><br>
            Provision target environments via IaC; harden baselines using Ansible or equivalent configuration management; execute data migrations
            (DB migration services, bulk object transfers, replication). Run rehearsals in lower environments, then execute production wave cutovers
            according to your chosen strategy, with practiced rollbacks. Validate stability, data integrity, and control effectiveness before
            decommissioning legacy environments.
          </li>
          <li>
            <strong>Phase 8 – Monitoring, FinOps & sustainment.</strong><br>
            Turn on full observability (metrics, logs, traces) and wire them into your central SIEM/SOC.
            Implement tagging and cost allocation for FinOps reporting; set budgets and alerts by business service.
            Establish SRE/operations runbooks, on-call rotations, and continuous improvement loops.
            Every quarter, revisit architecture decisions, optimize cost/performance, and incorporate lessons learned into the next wave or initiative.
          </li>
        </ol>
        <p style="margin-top:6px;font-size:0.8rem;color:#9ca3af;">
          Use this playbook as the narrative section in your Word documents and CCoE artifacts.
          For each phase, attach the concrete evidence (diagrams, Terraform plans, Ansible playbooks, migration runbooks, control mappings, and sign-off sheets).
        </p>
      `;
    }

    
    function buildSizingPlan(cloud, state) {
      const {
        peakUsers,
        peakRps,
        dataVolumeBand,
        dailyIngestBand,
        retentionPeriod,
        envScope = [],
        nonProdScale,
        regionCount,
        trafficPattern,
        criticality,
        dataType,
        dataSensitivity,
        geoPattern,
        latencySensitivity
      } = state;

      const users = Number(peakUsers) || 0;
      const rps = Number(peakRps) || 0;
      const envs = Array.isArray(envScope) ? envScope : [];

      let trafficBand = "moderate";
      if (rps >= 2000 || users >= 50000 || trafficPattern === "spiky") {
        trafficBand = "high";
      } else if ((rps && rps <= 100) || (users && users <= 5000) || trafficPattern === "low") {
        trafficBand = "low";
      }

      let computeSize = "Small–medium footprint";
      if (trafficBand === "low") computeSize = "Small footprint";
      if (trafficBand === "high") computeSize = "Medium–large footprint";

      if (criticality === "tier0" || criticality === "tier1") {
        computeSize += ", multi-AZ / multi-zone for HA";
      }

      let dataBandLabel = "";
      switch (dataVolumeBand) {
        case "xs": dataBandLabel = "sub-100 GB"; break;
        case "s": dataBandLabel = "100 GB – 1 TB"; break;
        case "m": dataBandLabel = "1 – 5 TB"; break;
        case "l": dataBandLabel = "5 – 20 TB"; break;
        case "xl": dataBandLabel = "20 TB+"; break;
      }

      let ingestLabel = "";
      switch (dailyIngestBand) {
        case "light": ingestLabel = "light daily change"; break;
        case "medium": ingestLabel = "moderate daily change"; break;
        case "heavy": ingestLabel = "heavy daily ingest"; break;
        case "very-heavy": ingestLabel = "very heavy streaming / ingest"; break;
      }

      let retentionLabel = "";
      switch (retentionPeriod) {
        case "short": retentionLabel = "short-term retention"; break;
        case "standard": retentionLabel = "standard (months–couple of years) retention"; break;
        case "long": retentionLabel = "long-term (multi-year) retention"; break;
        case "very-long": retentionLabel = "very long / archival retention"; break;
      }

      let storageTier;
      if (!retentionPeriod) {
        storageTier = "Mix of hot and cool storage tiers based on access patterns.";
      } else if (retentionPeriod === "short" || retentionPeriod === "standard") {
        storageTier = "Primarily hot / warm storage, with some cool tiering for older data.";
      } else {
        storageTier = "Hot storage for active data plus aggressive use of cool / archive tiers for retained data.";
      }

      if (
        dataSensitivity === "regulated" ||
        dataSensitivity === "ps-l4" ||
        dataSensitivity === "ps-l5" ||
        dataSensitivity === "ps-l6"
      ) {
        storageTier += " Ensure encryption-at-rest, KMS/HSM key management and retention policies aligned to regulatory requirements.";
      }

      let networkTier = "Standard regional connectivity.";
      if (
        geoPattern === "multi-region" ||
        regionCount === "2" ||
        regionCount === "2-active" ||
        regionCount === "3plus"
      ) {
        networkTier = "Multi-region design with private connectivity and global entry points (front door / anycast / global load balancer).";
      } else if (latencySensitivity === "ultra-low") {
        networkTier = "Single-region, low-latency design with zonal redundancy and careful placement.";
      }

      const envLabels = {
        dev: "Dev",
        test: "Test",
        stage: "Pre-prod / Stage",
        prod: "Prod",
        dr: "DR"
      };

      let nonProdFactor = 0.5;
      switch (nonProdScale) {
        case "full": nonProdFactor = 1; break;
        case "half": nonProdFactor = 0.5; break;
        case "quarter": nonProdFactor = 0.25; break;
        case "minimal": nonProdFactor = 0.1; break;
      }

      const rows = [];
      envs.forEach(env => {
        const isProd = env === "prod";
        const factor = isProd ? 1 : nonProdFactor;
        const sizeLabel =
          trafficBand === "low" ? "Small" :
          trafficBand === "high" ? "Large" :
          "Medium";

        const envCompute = isProd ? sizeLabel : sizeLabel + " × " + factor;
        const envNotes = isProd
          ? "Primary live workload."
          : "Scaled to ~" + Math.round(factor * 100) + "% of prod capacity.";

        rows.push(
          "<tr>" +
            "<td>" + (envLabels[env] || env) + "</td>" +
            "<td>" + envCompute + "</td>" +
            "<td>" + envNotes + "</td>" +
          "</tr>"
        );
      });

      let matrixHtml;
      if (rows.length) {
        matrixHtml = `
          <table class="sizing-table">
            <thead>
              <tr>
                <th>Environment</th>
                <th>Relative size</th>
                <th>Notes</th>
              </tr>
            </thead>
            <tbody>
              ${rows.join("")}
            </tbody>
          </table>
        `;
      } else {
        matrixHtml = "<p>No environments selected yet. Tick at least Prod plus relevant non-prod environments in Step 4.</p>";
      }

      const providerName =
        cloud === "azure" ? "Azure" :
        cloud === "aws"   ? "AWS" :
        cloud === "gcp"   ? "Google Cloud" :
                            "Oracle Cloud Infrastructure";

      const main = `
        <p>This is a <strong>${trafficBand}</strong> traffic workload on <strong>${providerName}</strong> with a <strong>${computeSize}</strong>.</p>
        <p>Data footprint: ${dataBandLabel || "not specified"}; ${ingestLabel || "ingest not specified"}; ${retentionLabel || "retention not specified"}.</p>
      `;

      const notes = `
        <p>${storageTier}</p>
        <p>${networkTier}</p>
        <p>Use this as the starting point for T-shirt sizing, cost estimation, and environment build-out in your landing zones.</p>
      `;

      return {
        main,
        notes,
        matrixHtml
      };
    }

document.addEventListener("DOMContentLoaded", function () {
      onCloudChange();
      showStep(1);
      updatePathGroups();

      const cloudSelect = document.getElementById("cloudProvider");
      if (cloudSelect) cloudSelect.addEventListener("change", onCloudChange);

      const initiativeSelect = document.getElementById("initiativeType");
      if (initiativeSelect) initiativeSelect.addEventListener("change", updatePathGroups);

      const backBtn = document.getElementById("backBtn");
      const nextBtn = document.getElementById("nextBtn");
      const generateBtn = document.getElementById("generateBtn");
      const fullBtn = document.getElementById("fullViewBtn");
      const printBtn = document.getElementById("printBtn");
      const wordBtn = document.getElementById("exportWordBtn");

      if (backBtn) backBtn.addEventListener("click", goBack);
      if (nextBtn) nextBtn.addEventListener("click", goNext);
      if (generateBtn) generateBtn.addEventListener("click", generateRecommendation);
      if (fullBtn) fullBtn.addEventListener("click", openFullViewWindow);
      if (printBtn) printBtn.addEventListener("click", openPrintView);
      if (wordBtn) wordBtn.addEventListener("click", exportRecommendationAsWord);
    });
  </script>
</body>
</html>
